não terminou o cóidigo pare onde parou: <!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Precificação de Emendas - Ministério do Esporte</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: #333;
        }

        .header {
            background-color: #003366;
            color: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .logo {
            height: 50px;
        }

        .container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        h1, h2 {
            color: #003366;
            margin-bottom: 20px;
            text-align: center;
        }

        .resumo-valores {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 30px;
            border-left: 4px solid #003366;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
        }

        .resumo-valores p {
            margin: 5px 0;
            min-width: 200px;
        }

        .resumo-valores span {
            font-weight: bold;
            color: #003366;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: 1px solid transparent;
            border-bottom: none;
            border-radius: 4px 4px 0 0;
            margin-right: 5px;
            background-color: #f1f1f1;
        }

        .tab.active {
            background-color: white;
            border-color: #ddd;
            border-bottom-color: white;
            color: #003366;
            font-weight: bold;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .formulario-item {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #003366;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }

        .empresas-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .empresa {
            background-color: white;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        .empresa h4 {
            margin-bottom: 10px;
            color: #003366;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }

        .btn {
            background-color: #003366;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
            margin-top: 10px;
        }

        .btn:hover {
            background-color: #002244;
        }

        .btn-success {
            background-color: #28a745;
        }

        .btn-success:hover {
            background-color: #218838;
        }

        .btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        .carrinho {
            margin-top: 30px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 4px;
        }

        .carrinho h3 {
            color: #003366;
            margin-bottom: 15px;
        }

        .carrinho-vazio {
            text-align: center;
            color: #666;
            padding: 20px;
        }

        .item-carrinho {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid #eee;
            align-items: center;
        }

        .item-carrinho-info {
            flex: 1;
        }

        .item-carrinho-acoes button {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            margin-left: 10px;
        }

        .total-carrinho {
            text-align: right;
            margin-top: 15px;
            font-weight: bold;
            font-size: 18px;
        }

        .acoes-carrinho {
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
            gap: 10px;
        }

        .declaracao-container {
            margin-top: 20px;
            padding: 15px;
            background-color: #ffffff;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .declaracao-container label {
            font-size: 14px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            padding: 15px;
            color: #666;
            font-size: 14px;
        }

        .suggestions {
            position: absolute;
            background: white;
            border: 1px solid #ddd;
            max-height: 200px;
            overflow-y: auto;
            width: 100%;
            z-index: 1000;
        }

        .suggestion-item {
            padding: 10px;
            cursor: pointer;
        }

        .suggestion-item:hover {
            background-color: #f0f0f0;
        }

        @media (max-width: 768px) {
            .container {
                margin: 15px;
                padding: 15px;
            }
            
            .empresas-container {
                grid-template-columns: 1fr;
            }
            
            .resumo-valores {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <img src="logo-ministerio-esporte.png" alt="Ministério do Esporte" class="logo">
        <h2>Sistema de Precificação de Emendas</h2>
    </header>

    <div class="container">
        <h1>Precificação de Itens</h1>
        
        <div class="resumo-valores">
            <p><span>Valor Total da Emenda:</span> <strong id="valor-total">R$ 0,00</strong></p>
            <p><span>Valor Gasto:</span> <strong id="valor-gasto">R$ 0,00</strong></p>
            <p><span>Valor Restante:</span> <strong id="valor-restante">R$ 0,00</strong></p>
        </div>

        <div class="tabs">
            <div class="tab active" data-tab="servicos">Serviços</div>
            <div class="tab" data-tab="material-esportivo">Material Esportivo</div>
            <div class="tab" data-tab="uniformes">Uniformes</div>
            <div class="tab" data-tab="identidades-divulgacoes">Identidades/Divulgações</div>
            <div class="tab" data-tab="alimentacao">Alimentação</div>
        </div>

        <!-- Formulário Serviços -->
        <div id="servicos" class="tab-content active">
            <div class="formulario-item">
                <h2>Adicionar Item - Serviços</h2>
                
                <div class="form-group">
                    <label for="srv-cargo">Serviço</label>
                    <select id="srv-cargo" onchange="toggleOutrosField('srv')">
                        <option value="Coordenador de eventos">Coordenador de eventos</option>
                        <option value="Coordenador de projetos sociais">Coordenador de projetos sociais</option>
                        <option value="Analista de marketing">Analista de marketing</option>
                        <option value="Consultor de sistemas de TI">Consultor de sistemas de TI</option>
                        <option value="Fisioterapeuta esportivo">Fisioterapeuta esportivo</option>
                        <option value="Preparador físico">Preparador físico</option>
                        <option value="Coordenador pedagógico">Coordenador pedagógico</option>
                        <option value="Assessor jurídico">Assessor jurídico</option>
                        <option value="Consultor jurídico">Consultor jurídico</option>
                        <option value="Assistente social">Assistente social</option>
                        <option value="Consultor administrativo">Consultor administrativo</option>
                        <option value="Contador">Contador</option>
                        <option value="Assessor de imprensa">Assessor de imprensa</option>
                        <option value="Locutor esportivo">Locutor esportivo</option>
                        <option value="Fotógrafo">Fotógrafo</option>
                        <option value="Tecnólogo em produção audiovisual">Tecnólogo em produção audiovisual</option>
                        <option value="Tecnólogo em produção multimídia">Tecnólogo em produção multimídia</option>
                        <option value="Desenhista de identidade visual">Desenhista de identidade visual</option>
                        <option value="Técnico de apoio ao usuário de informática (helpdesk)">Técnico de apoio ao usuário de informática (helpdesk)</option>
                        <option value="Técnico de suporte de TI">Técnico de suporte de TI</option>
                        <option value="Instrutor de cursos livres">Instrutor de cursos livres</option>
                        <option value="Operador de áudio">Operador de áudio</option>
                        <option value="Editor de TV e vídeo">Editor de TV e vídeo</option>
                        <option value="Coordenador administrativo">Coordenador administrativo</option>
                        <option value="Auxiliar administrativo">Auxiliar administrativo</option>
                        <option value="Assistente administrativo">Assistente administrativo</option>
                        <option value="Recepcionista, em geral">Recepcionista, em geral</option>
                        <option value="Auxiliar de limpeza">Auxiliar de limpeza</option>
                        <option value="Bombeiro civil">Bombeiro civil</option>
                        <option value="Segurança de evento">Segurança de evento</option>
                        <option value="Outros">Outros</option>
                    </select>
                </div>
                <div class="form-group" id="srv-outros-container" style="display: none;">
                    <label for="srv-outros">Especifique o Serviço</label>
                    <input type="text" id="srv-outros" placeholder="Digite o serviço">
                </div>
                
                <div class="form-group">
                    <label for="srv-descricao">Descrição do Serviço/Método de Cálculo</label>
                    <textarea id="srv-descricao" placeholder="Ex: PROFESSOR - Responsável pela preparação e execução das aulas"></textarea>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                    <div class="form-group">
                        <label for="srv-quantidade">Quantidade</label>
                        <input type="number" id="srv-quantidade" min="1" value="1">
                    </div>
                    
                    <div class="form-group">
                        <label for="srv-periodo">Diárias/Meses</label>
                        <select id="srv-periodo">
                            <option value="diarias">Diárias</option>
                            <option value="meses">Meses</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="srv-periodo-valor">Valor do Período</label>
                        <input type="number" id="srv-periodo-valor" min="1" value="1">
                    </div>
                    
                    <div class="form-group">
                        <label for="srv-total">Total</label>
                        <input type="text" id="srv-total" readonly>
                    </div>
                </div>
                
                <h3 style="margin-top: 20px;">Empresas Cotadas</h3>
                <div class="empresas-container">
                    <!-- Empresa 1 -->
                    <div class="empresa">
                        <h4>Empresa 1</h4>
                        <div class="form-group">
                            <label for="srv-empresa1-nome">Nome</label>
                            <input type="text" id="srv-empresa1-nome" placeholder="Nome da empresa">
                        </div>
                        <div class="form-group">
                            <label for="srv-empresa1-cnpj">CNPJ</label>
                            <input type="text" id="srv-empresa1-cnpj" placeholder="XX.XXX.XXX/XXXX-XX">
                        </div>
                        <div class="form-group">
                            <label for="srv-empresa1-link">Link (obrigatório)</label>
                            <input type="url" id="srv-empresa1-link" placeholder="https://..." required>
                        </div>
                        <div class="form-group">
                            <label for="srv-empresa1-unitario">Valor Unitário (R$)</label>
                            <input type="text" id="srv-empresa1-unitario" class="valor-monetario" placeholder="0,00">
                        </div>
                        <div class="form-group">
                            <label for="srv-empresa1-total">Valor Total (R$)</label>
                            <input type="text" id="srv-empresa1-total" readonly>
                        </div>
                        <div class="form-group">
                            <label for="srv-empresa1-selecionada">Selecionar Empresa</label>
                            <input type="radio" name="srv-empresa-selecionada" id="srv-empresa1-selecionada" value="1" onchange="mostrarJustificativa('srv', 1)">
                        </div>
                    </div>
                    
                    <!-- Empresa 2 -->
                    <div class="empresa">
                        <h4>Empresa 2</h4>
                        <div class="form-group">
                            <label for="srv-empresa2-nome">Nome</label>
                            <input type="text" id="srv-empresa2-nome" placeholder="Nome da empresa">
                        </div>
                        <div class="form-group">
                            <label for="srv-empresa2-cnpj">CNPJ</label>
                            <input type="text" id="srv-empresa2-cnpj" placeholder="XX.XXX.XXX/XXXX-XX">
                        </div>
                        <div class="form-group">
                            <label for="srv-empresa2-link">Link (obrigatório)</label>
                            <input type="url" id="srv-empresa2-link" placeholder="https://..." required>
                        </div>
                        <div class="form-group">
                            <label for="srv-empresa2-unitario">Valor Unitário (R$)</label>
                            <input type="text" id="srv-empresa2-unitario" class="valor-monetario" placeholder="0,00">
                        </div>
                        <div class="form-group">
                            <label for="srv-empresa2-total">Valor Total (R$)</label>
                            <input type="text" id="srv-empresa2-total" readonly>
                        </div>
                        <div class="form-group">
                            <label for="srv-empresa2-selecionada">Selecionar Empresa</label>
                            <input type="radio" name="srv-empresa-selecionada" id="srv-empresa2-selecionada" value="2" onchange="mostrarJustificativa('srv', 2)">
                        </div>
                    </div>
                    
                    <!-- Empresa 3 -->
                    <div class="empresa">
                        <h4>Empresa 3</h4>
                        <div class="form-group">
                            <label for="srv-empresa3-nome">Nome</label>
                            <input type="text" id="srv-empresa3-nome" placeholder="Nome da empresa">
                        </div>
                        <div class="form-group">
                            <label for="srv-empresa3-cnpj">CNPJ</label>
                            <input type="text" id="srv-empresa3-cnpj" placeholder="XX.XXX.XXX/XXXX-XX">
                        </div>
                        <div class="form-group">
                            <label for="srv-empresa3-link">Link (obrigatório)</label>
                            <input type="url" id="srv-empresa3-link" placeholder="https://..." required>
                        </div>
                        <div class="form-group">
                            <label for="srv-empresa3-unitario">Valor Unitário (R$)</label>
                            <input type="text" id="srv-empresa3-unitario" class="valor-monetario" placeholder="0,00">
                        </div>
                        <div class="form-group">
                            <label for="srv-empresa3-total">Valor Total (R$)</label>
                            <input type="text" id="srv-empresa3-total" readonly>
                        </div>
                        <div class="form-group">
                            <label for="srv-empresa3-selecionada">Selecionar Empresa</label>
                            <input type="radio" name="srv-empresa-selecionada" id="srv-empresa3-selecionada" value="3" onchange="mostrarJustificativa('srv', 3)">
                        </div>
                    </div>
                </div>
                
                <div class="form-group" style="margin-top: 20px;">
                    <label for="srv-menor-valor">Menor Valor Cotado (R$)</label>
                    <input type="text" id="srv-menor-valor" readonly>
                </div>
                
                <div class="form-group" id="srv-justificativa-container" style="display: none;">
                    <label for="srv-justificativa">Justificativa</label>
                    <textarea id="srv-justificativa" placeholder="Justifique a escolha de uma empresa com valor superior ao menor cotado"></textarea>
                </div>
                
                <button class="btn btn-success" id="srv-adicionar-carrinho">Adicionar ao Carrinho</button>
            </div>
        </div>

        <!-- Formulário Material Esportivo -->
        <div id="material-esportivo" class="tab-content">
            <div class="formulario-item">
                <h2>Adicionar Item - Material Esportivo</h2>
                
                <div class="form-group">
                    <label for="me-item">Item</label>
                    <input type="text" id="me-item" placeholder="Digite para buscar um item" oninput="filtrarItens('me')" autocomplete="off">
                    <div id="me-item-suggestions" class="suggestions" style="display: none;"></div>
                </div>
                
                <div class="form-group">
                    <label for="me-subitem">Subitem</label>
                    <input type="text" id="me-subitem" placeholder="Digite para buscar um subitem" oninput="filtrarSubitens('me')" autocomplete="off">
                    <div id="me-subitem-suggestions" class="suggestions" style="display: none;"></div>
                </div>
                
                <div class="form-group">
                    <label for="me-cod-catmat">CÓD. CATMAT/CATSER/CBO</label>
                    <input type="text" id="me-cod-catmat" readonly>
                </div>
                
                <div class="form-group">
                    <label for="me-tipo">Tipo</label>
                    <select id="me-tipo" onchange="toggleLocacaoFields()">
                        <option value="aquisicao">Aquisição</option>
                        <option value="locacao">Locação</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="me-descricao">Descrição do Item/Método de Cálculo</label>
                    <textarea id="me-descricao" placeholder="Ex: BOLA DE FUTEBOL - Utilizada para atividades esportivas"></textarea>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                    <div class="form-group">
                        <label for="me-quantidade">Quantidade</label>
                        <input type="number" id="me-quantidade" min="1" value="1">
                    </div>
                    
                    <div class="form-group" id="me-periodo-container" style="display: none;">
                        <label for="me-periodo">Diárias/Meses</label>
                        <select id="me-periodo">
                            <option value="diarias">Diárias</option>
                            <option value="meses">Meses</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="me-periodo-valor-container" style="display: none;">
                        <label for="me-periodo-valor">Valor do Período</label>
                        <input type="number" id="me-periodo-valor" min="1" value="1">
                    </div>
                    
                    <div class="form-group">
                        <label for="me-total">Total</label>
                        <input type="text" id="me-total" readonly>
                    </div>
                </div>
                
                <h3 style="margin-top: 20px;">Empresas Cotadas</h3>
                <div class="empresas-container">
                    <!-- Empresa 1 -->
                    <div class="empresa">
                        <h4>Empresa 1</h4>
                        <div class="form-group">
                            <label for="me-empresa1-nome">Nome</label>
                            <input type="text" id="me-empresa1-nome" placeholder="Nome da empresa">
                        </div>
                        <div class="form-group">
                            <label for="me-empresa1-cnpj">CNPJ</label>
                            <input type="text" id="me-empresa1-cnpj" placeholder="XX.XXX.XXX/XXXX-XX">
                        </div>
                        <div class="form-group">
                            <label for="me-empresa1-link">Link (obrigatório)</label>
                            <input type="url" id="me-empresa1-link" placeholder="https://..." required>
                        </div>
                        <div class="form-group">
                            <label for="me-empresa1-unitario">Valor Unitário (R$)</label>
                            <input type="text" id="me-empresa1-unitario" class="valor-monetario" placeholder="0,00">
                        </div>
                        <div class="form-group">
                            <label for="me-empresa1-total">Valor Total (R$)</label>
                            <input type="text" id="me-empresa1-total" readonly>
                        </div>
                        <div class="form-group">
                            <label for="me-empresa1-selecionada">Selecionar Empresa</label>
                            <input type="radio" name="me-empresa-selecionada" id="me-empresa1-selecionada" value="1" onchange="mostrarJustificativa('me', 1)">
                        </div>
                    </div>
                    
                    <!-- Empresa 2 -->
                    <div class="empresa">
                        <h4>Empresa 2</h4>
                        <div class="form-group">
                            <label for="me-empresa2-nome">Nome</label>
                            <input type="text" id="me-empresa2-nome" placeholder="Nome da empresa">
                        </div>
                        <div class="form-group">
                            <label for="me-empresa2-cnpj">CNPJ</label>
                            <input type="text" id="me-empresa2-cnpj" placeholder="XX.XXX.XXX/XXXX-XX">
                        </div>
                        <div class="form-group">
                            <label for="me-empresa2-link">Link (obrigatório)</label>
                            <input type="url" id="me-empresa2-link" placeholder="https://..." required>
                        </div>
                        <div class="form-group">
                            <label for="me-empresa2-unitario">Valor Unitário (R$)</label>
                            <input type="text" id="me-empresa2-unitario" class="valor-monetario" placeholder="0,00">
                        </div>
                        <div class="form-group">
                            <label for="me-empresa2-total">Valor Total (R$)</label>
                            <input type="text" id="me-empresa2-total" readonly>
                        </div>
                        <div class="form-group">
                            <label for="me-empresa2-selecionada">Selecionar Empresa</label>
                            <input type="radio" name="me-empresa-selecionada" id="me-empresa2-selecionada" value="2" onchange="mostrarJustificativa('me', 2)">
                        </div>
                    </div>
                    
                    <!-- Empresa 3 -->
                    <div class="empresa">
                        <h4>Empresa 3</h4>
                        <div class="form-group">
                            <label for="me-empresa3-nome">Nome</label>
                            <input type="text" id="me-empresa3-nome" placeholder="Nome da empresa">
                        </div>
                        <div class="form-group">
                            <label for="me-empresa3-cnpj">CNPJ</label>
                            <input type="text" id="me-empresa3-cnpj" placeholder="XX.XXX.XXX/XXXX-XX">
                        </div>
                        <div class="form-group">
                            <label for="me-empresa3-link">Link (obrigatório)</label>
                            <input type="url" id="me-empresa3-link" placeholder="https://..." required>
                        </div>
                        <div class="form-group">
                            <label for="me-empresa3-unitario">Valor Unitário (R$)</label>
                            <input type="text" id="me-empresa3-unitario" class="valor-monetario" placeholder="0,00">
                        </div>
                        <div class="form-group">
                            <label for="me-empresa3-total">Valor Total (R$)</label>
                            <input type="text" id="me-empresa3-total" readonly>
                        </div>
                        <div class="form-group">
                            <label for="me-empresa3-selecionada">Selecionar Empresa</label>
                            <input type="radio" name="me-empresa-selecionada" id="me-empresa3-selecionada" value="3" onchange="mostrarJustificativa('me', 3)">
                        </div>
                    </div>
                </div>
                
                <div class="form-group" style="margin-top: 20px;">
                    <label for="me-menor-valor">Menor Valor Cotado (R$)</label>
                    <input type="text" id="me-menor-valor" readonly>
                </div>
                
                <div class="form-group" id="me-justificativa-container" style="display: none;">
                    <label for="me-justificativa">Justificativa</label>
                    <textarea id="me-justificativa" placeholder="Justifique a escolha de uma empresa com valor superior ao menor cotado"></textarea>
                </div>
                
                <button class="btn btn-success" id="me-adicionar-carrinho">Adicionar ao Carrinho</button>
            </div>
        </div>

        <!-- Formulário Uniformes -->
        <div id="uniformes" class="tab-content">
            <div class="formulario-item">
                <h2>Adicionar Item - Uniformes</h2>
                
                <div class="form-group">
                    <label for="uni-item">Item</label>
                    <input type="text" id="uni-item" placeholder="Digite para buscar um item" oninput="filtrarItens('uni')" autocomplete="off">
                    <div id="uni-item-suggestions" class="suggestions" style="display: none;"></div>
                </div>
                
                <div class="form-group">
                    <label for="uni-subitem">Subitem</label>
                    <input type="text" id="uni-subitem" placeholder="Digite para buscar um subitem" oninput="filtrarSubitens('uni')" autocomplete="off">
                    <div id="uni-subitem-suggestions" class="suggestions" style="display: none;"></div>
                </div>
                
                <div class="form-group">
                    <label for="uni-cod-catmat">CÓD. CATMAT/CATSER/CBO</label>
                    <input type="text" id="uni-cod-catmat" readonly>
                </div>
                
                <div class="form-group">
                    <label for="uni-descricao">Descrição do Item/Método de Cálculo</label>
                    <textarea id="uni-descricao" placeholder="Ex: CAMISA ESPORTIVA - Uniforme para atletas"></textarea>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                    <div class="form-group">
                        <label for="uni-quantidade">Quantidade</label>
                        <input type="number" id="uni-quantidade" min="1" value="1">
                    </div>
                    
                    <div class="form-group">
                        <label for="uni-periodo">Diárias/Meses</label>
                        <select id="uni-periodo">
                            <option value="diarias">Diárias</option>
                            <option value="meses">Meses</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="uni-periodo-valor">Valor do Período</label>
                        <input type="number" id="uni-periodo-valor" min="1" value="1">
                    </div>
                    
                    <div class="form-group">
                        <label for="uni-total">Total</label>
                        <input type="text" id="uni-total" readonly>
                    </div>
                </div>
                
                <h3 style="margin-top: 20px;">Empresas Cotadas</h3>
                <div class="empresas-container">
                    <!-- Empresa 1 -->
                    <div class="empresa">
                        <h4>Empresa 1</h4>
                        <div class="form-group">
                            <label for="uni-empresa1-nome">Nome</label>
                            <input type="text" id="uni-empresa1-nome" placeholder="Nome da empresa">
                        </div>
                        <div class="form-group">
                            <label for="uni-empresa1-cnpj">CNPJ</label>
                            <input type="text" id="uni-empresa1-cnpj" placeholder="XX.XXX.XXX/XXXX-XX">
                        </div>
                        <div class="form-group">
                            <label for="uni-empresa1-link">Link (obrigatório)</label>
                            <input type="url" id="uni-empresa1-link" placeholder="https://..." required>
                        </div>
                        <div class="form-group">
                            <label for="uni-empresa1-unitario">Valor Unitário (R$)</label>
                            <input type="text" id="uni-empresa1-unitario" class="valor-monetario" placeholder="0,00">
                        </div>
                        <div class="form-group">
                            <label for="uni-empresa1-total">Valor Total (R$)</label>
                            <input type="text" id="uni-empresa1-total" readonly>
                        </div>
                        <div class="form-group">
                            <label for="uni-empresa1-selecionada">Selecionar Empresa</label>
                            <input type="radio" name="uni-empresa-selecionada" id="uni-empresa1-selecionada" value="1" onchange="mostrarJustificativa('uni', 1)">
                        </div>
                    </div>
                    
                    <!-- Empresa 2 -->
                    <div class="empresa">
                        <h4>Empresa 2</h4>
                        <div class="form-group">
                            <label for="uni-empresa2-nome">Nome</label>
                            <input type="text" id="uni-empresa2-nome" placeholder="Nome da empresa">
                        </div>
                        <div class="form-group">
                            <label for="uni-empresa2-cnpj">CNPJ</label>
                            <input type="text" id="uni-empresa2-cnpj" placeholder="XX.XXX.XXX/XXXX-XX">
                        </div>
                        <div class="form-group">
                            <label for="uni-empresa2-link">Link (obrigatório)</label>
                            <input type="url" id="uni-empresa2-link" placeholder="https://..." required>
                        </div>
                        <div class="form-group">
                            <label for="uni-empresa2-unitario">Valor Unitário (R$)</label>
                            <input type="text" id="uni-empresa2-unitario" class="valor-monetario" placeholder="0,00">
                        </div>
                        <div class="form-group">
                            <label for="uni-empresa2-total">Valor Total (R$)</label>
                            <input type="text" id="uni-empresa2-total" readonly>
                        </div>
                        <div class="form-group">
                            <label for="uni-empresa2-selecionada">Selecionar Empresa</label>
                            <input type="radio" name="uni-empresa-selecionada" id="uni-empresa2-selecionada" value="2" onchange="mostrarJustificativa('uni', 2)">
                        </div>
                    </div>
                    
                    <!-- Empresa 3 -->
                    <div class="empresa">
                        <h4>Empresa 3</h4>
                        <div class="form-group">
                            <label for="uni-empresa3-nome">Nome</label>
                            <input type="text" id="uni-empresa3-nome" placeholder="Nome da empresa">
                        </div>
                        <div class="form-group">
                            <label for="uni-empresa3-cnpj">CNPJ</label>
                            <input type="text" id="uni-empresa3-cnpj" placeholder="XX.XXX.XXX/XXXX-XX">
                        </div>
                        <div class="form-group">
                            <label for="uni-empresa3-link">Link (obrigatório)</label>
                            <input type="url" id="uni-empresa3-link" placeholder="https://..." required>
                        </div>
                        <div class="form-group">
                            <label for="uni-empresa3-unitario">Valor Unitário (R$)</label>
                            <input type="text" id="uni-empresa3-unitario" class="valor-monetario" placeholder="0,00">
                        </div>
                        <div class="form-group">
                            <label for="uni-empresa3-total">Valor Total (R$)</label>
                            <input type="text" id="uni-empresa3-total" readonly>
                        </div>
                        <div class="form-group">
                            <label for="uni-empresa3-selecionada">Selecionar Empresa</label>
                            <input type="radio" name="uni-empresa-selecionada" id="uni-empresa3-selecionada" value="3" onchange="mostrarJustificativa('uni', 3)">
                        </div>
                    </div>
                </div>
                
                <div class="form-group" style="margin-top: 20px;">
                    <label for="uni-menor-valor">Menor Valor Cotado (R$)</label>
                    <input type="text" id="uni-menor-valor" readonly>
                </div>
                
                <div class="form-group" id="uni-justificativa-container" style="display: none;">
                    <label for="uni-justificativa">Justificativa</label>
                    <textarea id="uni-justificativa" placeholder="Justifique a escolha de uma empresa com valor superior ao menor cotado"></textarea>
                </div>
                
                <button class="btn btn-success" id="uni-adicionar-carrinho">Adicionar ao Carrinho</button>
            </div>
        </div>

        <!-- Formulário Identidades/Divulgações -->
        <div id="identidades-divulgacoes" class="tab-content">
            <div class="formulario-item">
                <h2>Adicionar Item - Identidades/Divulgações</h2>
                
                <div class="form-group">
                    <label for="idv-item">Item</label>
                    <input type="text" id="idv-item" placeholder="Digite para buscar um item" oninput="filtrarItens('idv')" autocomplete="off">
                    <div id="idv-item-suggestions" class="suggestions" style="display: none;"></div>
                </div>
                
                <div class="form-group">
                    <label for="idv-subitem">Subitem</label>
                    <input type="text" id="idv-subitem" placeholder="Digite para buscar um subitem" oninput="filtrarSubitens('idv')" autocomplete="off">
                    <div id="idv-subitem-suggestions" class="suggestions" style="display: none;"></div>
                </div>
                
                <div class="form-group">
                    <label for="idv-cod-catmat">CÓD. CATMAT/CATSER/CBO</label>
                    <input type="text" id="idv-cod-catmat" readonly>
                </div>
                
                <div class="form-group">
                    <label for="idv-descricao">Descrição do Item/Método de Cálculo</label>
                    <textarea id="idv-descricao" placeholder="Ex: BANNER PROMOCIONAL - Material de divulgação do evento"></textarea>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                    <div class="form-group">
                        <label for="idv-quantidade">Quantidade</label>
                        <input type="number" id="idv-quantidade" min="1" value="1">
                    </div>
                    
                    <div class="form-group">
                        <label for="idv-periodo">Diárias/Meses</label>
                        <select id="idv-periodo">
                            <option value="diarias">Diárias</option>
                            <option value="meses">Meses</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="idv-periodo-valor">Valor do Período</label>
                        <input type="number" id="idv-periodo-valor" min="1" value="1">
                    </div>
                    
                    <div class="form-group">
                        <label for="idv-total">Total</label>
                        <input type="text" id="idv-total" readonly>
                    </div>
                </div>
                
                <h3 style="margin-top: 20px;">Empresas Cotadas</h3>
                <div class="empresas-container">
                    <!-- Empresa 1 -->
                    <div class="empresa">
                        <h4>Empresa 1</h4>
                        <div class="form-group">
                            <label for="idv-empresa1-nome">Nome</label>
                            <input type="text" id="idv-empresa1-nome" placeholder="Nome da empresa">
                        </div>
                        <div class="form-group">
                            <label for="idv-empresa1-cnpj">CNPJ</label>
                            <input type="text" id="idv-empresa1-cnpj" placeholder="XX.XXX.XXX/XXXX-XX">
                        </div>
                        <div class="form-group">
                            <label for="idv-empresa1-link">Link (obrigatório)</label>
                            <input type="url" id="idv-empresa1-link" placeholder="https://..." required>
                        </div>
                        <div class="form-group">
                            <label for="idv-empresa1-unitario">Valor Unitário (R$)</label>
                            <input type="text" id="idv-empresa1-unitario" class="valor-monetario" placeholder="0,00">
                        </div>
                        <div class="form-group">
                            <label for="idv-empresa1-total">Valor Total (R$)</label>
                            <input type="text" id="idv-empresa1-total" readonly>
                        </div>
                        <div class="form-group">
                            <label for="idv-empresa1-selecionada">Selecionar Empresa</label>
                            <input type="radio" name="idv-empresa-selecionada" id="idv-empresa1-selecionada" value="1" onchange="mostrarJustificativa('idv', 1)">
                        </div>
                    </div>
                    
                    <!-- Empresa 2 -->
                    <div class="empresa">
                        <h4>Empresa 2</h4>
                        <div class="form-group">
                            <label for="idv-empresa2-nome">Nome</label>
                            <input type="text" id="idv-empresa2-nome" placeholder="Nome da empresa">
                        </div>
                        <div class="form-group">
                            <label for="idv-empresa2-cnpj">CNPJ</label>
                            <input type="text" id="idv-empresa2-cnpj" placeholder="XX.XXX.XXX/XXXX-XX">
                        </div>
                        <div class="form-group">
                            <label for="idv-empresa2-link">Link (obrigatório)</label>
                            <input type="url" id="idv-empresa2-link" placeholder="https://..." required>
                        </div>
                        <div class="form-group">
                            <label for="idv-empresa2-unitario">Valor Unitário (R$)</label>
                            <input type="text" id="idv-empresa2-unitario" class="valor-monetario" placeholder="0,00">
                        </div>
                        <div class="form-group">
                            <label for="idv-empresa2-total">Valor Total (R$)</label>
                            <input type="text" id="idv-empresa2-total" readonly>
                        </div>
                        <div class="form-group">
                            <label for="idv-empresa2-selecionada">Selecionar Empresa</label>
                            <input type="radio" name="idv-empresa-selecionada" id="idv-empresa2-selecionada" value="2" onchange="mostrarJustificativa('idv', 2)">
                        </div>
                    </div>
                    
                    <!-- Empresa 3 -->
                    <div class="empresa">
                        <h4>Empresa 3</h4>
                        <div class="form-group">
                            <label for="idv-empresa3-nome">Nome</label>
                            <input type="text" id="idv-empresa3-nome" placeholder="Nome da empresa">
                        </div>
                        <div class="form-group">
                            <label for="idv-empresa3-cnpj">CNPJ</label>
                            <input type="text" id="idv-empresa3-cnpj" placeholder="XX.XXX.XXX/XXXX-XX">
                        </div>
                        <div class="form-group">
                            <label for="idv-empresa3-link">Link (obrigatório)</label>
                            <input type="url" id="idv-empresa3-link" placeholder="https://..." required>
                        </div>
                        <div class="form-group">
                            <label for="idv-empresa3-unitario">Valor Unitário (R$)</label>
                            <input type="text" id="idv-empresa3-unitario" class="valor-monetario" placeholder="0,00">
                        </div>
                        <div class="form-group">
                            <label for="idv-empresa3-total">Valor Total (R$)</label>
                            <input type="text" id="idv-empresa3-total" readonly>
                        </div>
                        <div class="form-group">
                            <label for="idv-empresa3-selecionada">Selecionar Empresa</label>
                            <input type="radio" name="idv-empresa-selecionada" id="idv-empresa3-selecionada" value="3" onchange="mostrarJustificativa('idv', 3)">
                        </div>
                    </div>
                </div>
                
                <div class="form-group" style="margin-top: 20px;">
                    <label for="idv-menor-valor">Menor Valor Cotado (R$)</label>
                    <input type="text" id="idv-menor-valor" readonly>
                </div>
                
                <div class="form-group" id="idv-justificativa-container" style="display: none;">
                    <label for="idv-justificativa">Justificativa</label>
                    <textarea id="idv-justificativa" placeholder="Justifique a escolha de uma empresa com valor superior ao menor cotado"></textarea>
                </div>
                
                <button class="btn btn-success" id="idv-adicionar-carrinho">Adicionar ao Carrinho</button>
            </div>
        </div>

        <!-- Formulário Alimentação -->
        <div id="alimentacao" class="tab-content">
            <div class="formulario-item">
                <h2>Adicionar Item - Alimentação</h2>
                
                <div class="form-group">
                    <label for="ali-item">Item</label>
                    <input type="text" id="ali-item" placeholder="Digite para buscar um item" oninput="filtrarItens('ali')" autocomplete="off">
                    <div id="ali-item-suggestions" class="suggestions" style="display: none;"></div>
                </div>
                
                <div class="form-group">
                    <label for="ali-subitem">Subitem</label>
                    <input type="text" id="ali-subitem" placeholder="Digite para buscar um subitem" oninput="filtrarSubitens('ali')" autocomplete="off">
                    <div id="ali-subitem-suggestions" class="suggestions" style="display: none;"></div>
                </div>
                
                <div class="form-group">
                    <label for="ali-cod-catmat">CÓD. CATMAT/CATSER/CBO</label>
                    <input type="text" id="ali-cod-catmat" readonly>
                </div>
                
                <div class="form-group">
                    <label for="ali-descricao">Descrição do Item/Método de Cálculo</label>
                    <textarea id="ali-descricao" placeholder="Ex: REFEIÇÃO COMPLETA - Almoço para participantes do evento"></textarea>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                    <div class="form-group">
                        <label for="ali-quantidade">Quantidade</label>
                        <input type="number" id="ali-quantidade" min="1" value="1">
                    </div>
                    
                    <div class="form-group">
                        <label for="ali-periodo">Diárias/Meses</label>
                        <select id="ali-periodo">
                            <option value="diarias">Diárias</option>
                            <option value="meses">Meses</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="ali-periodo-valor">Valor do Período</label>
                        <input type="number" id="ali-periodo-valor" min="1" value="1">
                    </div>
                    
                    <div class="form-group">
                        <label for="ali-total">Total</label>
                        <input type="text" id="ali-total" readonly>
                    </div>
                </div>
                
                <h3 style="margin-top: 20px;">Empresas Cotadas</h3>
                <div class="empresas-container">
                    <!-- Empresa 1 -->
                    <div class="empresa">
                        <h4>Empresa 1</h4>
                        <div class="form-group">
                            <label for="ali-empresa1-nome">Nome</label>
                            <input type="text" id="ali-empresa1-nome" placeholder="Nome da empresa">
                        </div>
                        <div class="form-group">
                            <label for="ali-empresa1-cnpj">CNPJ</label>
                            <input type="text" id="ali-empresa1-cnpj" placeholder="XX.XXX.XXX/XXXX-XX">
                        </div>
                        <div class="form-group">
                            <label for="ali-empresa1-link">Link (obrigatório)</label>
                            <input type="url" id="ali-empresa1-link" placeholder="https://..." required>
                        </div>
                        <div class="form-group">
                            <label for="ali-empresa1-unitario">Valor Unitário (R$)</label>
                            <input type="text" id="ali-empresa1-unitario" class="valor-monetario" placeholder="0,00">
                        </div>
                        <div class="form-group">
                            <label for="ali-empresa1-total">Valor Total (R$)</label>
                            <input type="text" id="ali-empresa1-total" readonly>
                        </div>
                        <div class="form-group">
                            <label for="ali-empresa1-selecionada">Selecionar Empresa</label>
                            <input type="radio" name="ali-empresa-selecionada" id="ali-empresa1-selecionada" value="1" onchange="mostrarJustificativa('ali', 1)">
                        </div>
                    </div>
                    
                    <!-- Empresa 2 -->
                    <div class="empresa">
                        <h4>Empresa 2</h4>
                        <div class="form-group">
                            <label for="ali-empresa2-nome">Nome</label>
                            <input type="text" id="ali-empresa2-nome" placeholder="Nome da empresa">
                        </div>
                        <div class="form-group">
                            <label for="ali-empresa2-cnpj">CNPJ</label>
                            <input type="text" id="ali-empresa2-cnpj" placeholder="XX.XXX.XXX/XXXX-XX">
                        </div>
                        <div class="form-group">
                            <label for="ali-empresa2-link">Link (obrigatório)</label>
                            <input type="url" id="ali-empresa2-link" placeholder="https://..." required>
                        </div>
                        <div class="form-group">
                            <label for="ali-empresa2-unitario">Valor Unitário (R$)</label>
                            <input type="text" id="ali-empresa2-unitario" class="valor-monetario" placeholder="0,00">
                        </div>
                        <div class="form-group">
                            <label for="ali-empresa2-total">Valor Total (R$)</label>
                            <input type="text" id="ali-empresa2-total" readonly>
                        </div>
                        <div class="form-group">
                            <label for="ali-empresa2-selecionada">Selecionar Empresa</label>
                            <input type="radio" name="ali-empresa-selecionada" id="ali-empresa2-selecionada" value="2" onchange="mostrarJustificativa('ali', 2)">
                        </div>
                    </div>
                    
                    <!-- Empresa 3 -->
                    <div class="empresa">
                        <h4>Empresa 3</h4>
                        <div class="form-group">
                            <label for="ali-empresa3-nome">Nome</label>
                            <input type="text" id="ali-empresa3-nome" placeholder="Nome da empresa">
                        </div>
                        <div class="form-group">
                            <label for="ali-empresa3-cnpj">CNPJ</label>
                            <input type="text" id="ali-empresa3-cnpj" placeholder="XX.XXX.XXX/XXXX-XX">
                        </div>
                        <div class="form-group">
                            <label for="ali-empresa3-link">Link (obrigatório)</label>
                            <input type="url" id="ali-empresa3-link" placeholder="https://..." required>
                        </div>
                        <div class="form-group">
                            <label for="ali-empresa3-unitario">Valor Unitário (R$)</label>
                            <input type="text" id="ali-empresa3-unitario" class="valor-monetario" placeholder="0,00">
                        </div>
                        <div class="form-group">
                            <label for="ali-empresa3-total">Valor Total (R$)</label>
                            <input type="text" id="ali-empresa3-total" readonly>
                        </div>
                        <div class="form-group">
                            <label for="ali-empresa3-selecionada">Selecionar Empresa</label>
                            <input type="radio" name="ali-empresa-selecionada" id="ali-empresa3-selecionada" value="3" onchange="mostrarJustificativa('ali', 3)">
                        </div>
                    </div>
                </div>
                
                <div class="form-group" style="margin-top: 20px;">
                    <label for="ali-menor-valor">Menor Valor Cotado (R$)</label>
                    <input type="text" id="ali-menor-valor" readonly>
                </div>
                
                <div class="form-group" id="ali-justificativa-container" style="display: none;">
                    <label for="ali-justificativa">Justificativa</label>
                    <textarea id="ali-justificativa" placeholder="Justifique a escolha de uma empresa com valor superior ao menor cotado"></textarea>
                </div>
                
                <button class="btn btn-success" id="ali-adicionar-carrinho">Adicionar ao Carrinho</button>
            </div>
        </div>

        <!-- Carrinho de Compras -->
        <div class="carrinho">
            <h3>Carrinho de Compras</h3>
            <div id="lista-carrinho" class="carrinho-vazio">
                Nenhum item adicionado ao carrinho
            </div>
            <div id="total-carrinho" class="total-carrinho">
                Total no Carrinho: R$ 0,00
            </div>
            <div class="declaracao-container">
                <label>
                    <input type="checkbox" id="declaracao-checkbox">
                    Declaro que os custos aqui registrados estão em estrita conformidade aos orçamentos apresentados para fins de comprovação dos valores estimados de cada item.
                </label>
            </div>
            <div class="acoes-carrinho">
                <button class="btn" id="btn-exportar-excel" disabled>Gerar Excel</button>
                <button class="btn btn-success" id="btn-finalizar">Finalizar Precificação</button>
            </div>
        </div>
    </div>

    <footer class="footer">
        © 2025 Ministério do Esporte - Todos os direitos reservados
    </footer>

    <script>
document.addEventListener('DOMContentLoaded', function() {
    // Verificar se a biblioteca SheetJS está carregada
    if (typeof XLSX === 'undefined') {
        alert('Erro: A biblioteca SheetJS não foi carregada. Verifique sua conexão com a internet ou tente novamente.');
        return;
    }

    // Variáveis para armazenar os dados da planilha
    let uniformesData = [];
    let materialEsportivoData = [];
    let identidadesDivulgacoesData = [];
    let alimentacaoData = [];

    // Carregar a planilha Base_Dados.xlsx
    async function carregarPlanilha() {
        try {
            const response = await fetch('/data/Base_Dados.xlsx');
            if (!response.ok) throw new Error('Erro ao carregar o arquivo Excel');

            const data = await response.arrayBuffer();
            const workbook = XLSX.read(data, { type: 'array' });

            // Aba UNIFORME
            const uniformeSheet = workbook.Sheets['UNIFORME'];
            if (!uniformeSheet) throw new Error('Aba UNIFORME não encontrada');
            uniformesData = XLSX.utils.sheet_to_json(uniformeSheet, { header: ['ITEM', 'COD_CATMAT', 'SUBITEM'] }).slice(1);

            // Aba MATERIAL ESPORTIVO
            const materialEsportivoSheet = workbook.Sheets['MATERIAL ESPORTIVO'];
            if (!materialEsportivoSheet) throw new Error('Aba MATERIAL ESPORTIVO não encontrada');
            materialEsportivoData = XLSX.utils.sheet_to_json(materialEsportivoSheet, { header: ['ITEM', 'COD_CATMAT', 'SUBITEM'] }).slice(1);

            // Aba IDENTIDADES/DIVULGAÇÕES
            const identidadesDivulgacoesSheet = workbook.Sheets['IDENTIDADES_DIVULGACOES'];
            if (!identidadesDivulgacoesSheet) throw new Error('Aba IDENTIDADES_DIVULGACOES não encontrada');
            identidadesDivulgacoesData = XLSX.utils.sheet_to_json(identidadesDivulgacoesSheet, { header: ['ITEM', 'COD_CATMAT', 'SUBITEM'] }).slice(1);

            // Aba ALIMENTAÇÃO
            const alimentacaoSheet = workbook.Sheets['ALIMENTACAO'];
            if (!alimentacaoSheet) throw new Error('Aba ALIMENTACAO não encontrada');
            alimentacaoData = XLSX.utils.sheet_to_json(alimentacaoSheet, { header: ['ITEM', 'COD_CATMAT', 'SUBITEM'] }).slice(1);
        } catch (error) {
            console.error('Erro ao carregar a planilha:', error);
            alert('Erro ao carregar a base de dados. Verifique o console para mais detalhes.');
        }
    }

    // Funções de filtragem para itens e subitens
    window.filtrarItens = function(prefixo) {
        const input = document.getElementById(`${prefixo}-item`);
        const suggestions = document.getElementById(`${prefixo}-item-suggestions`);
        const dados = prefixo === 'uni' ? uniformesData : 
                     prefixo === 'me' ? materialEsportivoData : 
                     prefixo === 'idv' ? identidadesDivulgacoesData : 
                     alimentacaoData;
        const query = input.value.toLowerCase();

        if (query.length < 2) {
            suggestions.style.display = 'none';
            return;
        }

        const itensUnicos = [...new Set(dados.map(row => row.ITEM))].filter(item => 
            item && item.toLowerCase().includes(query)
        );

        suggestions.innerHTML = itensUnicos.map(item => 
            `<div class="suggestion-item" onclick="selecionarItem('${prefixo}', '${item.replace(/'/g, "\\'")}')">${item}</div>`
        ).join('');

        suggestions.style.display = itensUnicos.length ? 'block' : 'none';
    }

    window.filtrarSubitens = function(prefixo) {
        const itemInput = document.getElementById(`${prefixo}-item`).value;
        const subitemInput = document.getElementById(`${prefixo}-subitem`);
        const suggestions = document.getElementById(`${prefixo}-subitem-suggestions`);
        const codCatmatInput = document.getElementById(`${prefixo}-cod-catmat`);
        const dados = prefixo === 'uni' ? uniformesData : 
                     prefixo === 'me' ? materialEsportivoData : 
                     prefixo === 'idv' ? identidadesDivulgacoesData : 
                     alimentacaoData;
        const query = subitemInput.value.toLowerCase();

        if (!itemInput || query.length < 2) {
            suggestions.style.display = 'none';
            return;
        }

        const subitens = dados.filter(row => 
            row.ITEM === itemInput && row.SUBITEM && row.SUBITEM.toLowerCase().includes(query)
        );

        suggestions.innerHTML = subitens.map(row => 
            `<div class="suggestion-item" onclick="selecionarSubitem('${prefixo}', '${row.SUBITEM.replace(/'/g, "\\'")}', '${row.COD_CATMAT || ''}')">${row.SUBITEM}</div>`
        ).join('');

        suggestions.style.display = subitens.length ? 'block' : 'none';
    }

    window.selecionarItem = function(prefixo, item) {
        const input = document.getElementById(`${prefixo}-item`);
        const suggestions = document.getElementById(`${prefixo}-item-suggestions`);
        const subitemInput = document.getElementById(`${prefixo}-subitem`);
        input.value = item;
        subitemInput.value = '';
        suggestions.style.display = 'none';
        filtrarSubitens(prefixo);
    }

    window.selecionarSubitem = function(prefixo, subitem, codCatmat) {
        const subitemInput = document.getElementById(`${prefixo}-subitem`);
        const suggestions = document.getElementById(`${prefixo}-subitem-suggestions`);
        const codCatmatInput = document.getElementById(`${prefixo}-cod-catmat`);
        subitemInput.value = subitem;
        codCatmatInput.value = codCatmat;
        suggestions.style.display = 'none';
    }

    // Chamar a função para carregar a planilha
    carregarPlanilha();

    // Recupera valores da sessionStorage
    let numeroProposta = sessionStorage.getItem('numeroProposta') || 'sem-numero';
    numeroProposta = numeroProposta.replace(/[^a-zA-Z0-9_-]/g, '_');
    const valorEmenda = parseFloat(sessionStorage.getItem('valorEmenda')) || 0;
    document.getElementById('valor-total').textContent = formatarMoeda(valorEmenda);
    document.getElementById('valor-restante').textContent = formatarMoeda(valorEmenda);
    
    // Variáveis do carrinho
    let carrinho = [];
    let valorGasto = 0;

    // Controle do checkbox de declaração
    const declaracaoCheckbox = document.getElementById('declaracao-checkbox');
    const btnExportarExcel = document.getElementById('btn-exportar-excel');
    
    declaracaoCheckbox.addEventListener('change', function() {
        btnExportarExcel.disabled = !this.checked;
    });
    
    // Sistema de abas
    const tabs = document.querySelectorAll('.tab');
    tabs.forEach(tab => {
        tab.addEventListener('click', function() {
            tabs.forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            
            const tabId = this.getAttribute('data-tab');
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabId).classList.add('active');
        });
    });

    // Função para alternar o campo "Outros"
    window.toggleOutrosField = function(prefixo) {
        const cargoSelect = document.getElementById(`${prefixo}-cargo`);
        const outrosContainer = document.getElementById(`${prefixo}-outros-container`);
        if (cargoSelect.value === "Outros") {
            outrosContainer.style.display = 'block';
        } else {
            outrosContainer.style.display = 'none';
        }
    }

    // Função para alternar campos de locação/aquisição
    window.toggleLocacaoFields = function() {
        const tipo = document.getElementById('me-tipo').value;
        const periodoContainer = document.getElementById('me-periodo-container');
        const periodoValorContainer = document.getElementById('me-periodo-valor-container');
        if (tipo === 'aquisicao') {
            periodoContainer.style.display = 'none';
            periodoValorContainer.style.display = 'none';
            document.getElementById('me-periodo').value = 'diarias';
            document.getElementById('me-periodo-valor').value = '1';
        } else {
            periodoContainer.style.display = 'block';
            periodoValorContainer.style.display = 'block';
        }
        calcularTotal('me');
    }

    // Função para mostrar campo de justificativa
    window.mostrarJustificativa = function(prefixo, empresaIndex) {
        const menorValor = parseFloat(document.getElementById(`${prefixo}-menor-valor`).value.replace('R$ ', '').replace('.', '').replace(',', '.')) || 0;
        const valorSelecionado = parseFloat(document.getElementById(`${prefixo}-empresa${empresaIndex}-total`).value.replace('R$ ', '').replace('.', '').replace(',', '.')) || 0;
        const justificativaContainer = document.getElementById(`${prefixo}-justificativa-container`);
        
        if (valorSelecionado > menorValor) {
            justificativaContainer.style.display = 'block';
        } else {
            justificativaContainer.style.display = 'none';
        }
    }

    // Cálculos para cada aba
    const prefixes = ['srv', 'me', 'uni', 'idv', 'ali'];
    prefixes.forEach(prefixo => {
        const quantidadeInput = document.getElementById(`${prefixo}-quantidade`);
        const periodoValorInput = document.getElementById(`${prefixo}-periodo-valor`);
        const totalInput = document.getElementById(`${prefixo}-total`);

        function calcularTotal() {
            const quantidade = parseInt(quantidadeInput.value) || 0;
            let total = quantidade;
            if (prefixo === 'me' && document.getElementById('me-tipo').value === 'locacao') {
                const periodoValor = parseInt(periodoValorInput.value) || 0;
                total = quantidade * periodoValor;
            } else if (prefixo !== 'me') {
                const periodoValor = parseInt(periodoValorInput.value) || 0;
                total = quantidade * periodoValor;
            }
            totalInput.value = total;
            calcularTotaisEmpresas(prefixo);
            return total;
        }

        quantidadeInput.addEventListener('change', () => calcularTotal());
        if (periodoValorInput) {
            periodoValorInput.addEventListener('change', () => calcularTotal());
        }
        if (prefixo === 'me') {
            document.getElementById('me-tipo').addEventListener('change', () => calcularTotal());
        }
    });

    // Função para calcular totais das empresas
    function calcularTotaisEmpresas(prefixo) {
        const total = parseInt(document.getElementById(`${prefixo}-total`).value) || 0;
        let menorValor = Infinity;
        
        for (let i = 1; i <= 3; i++) {
            const unitarioInput = document.getElementById(`${prefixo}-empresa${i}-unitario`);
            if (!unitarioInput) continue;
            const unitario = parseFloat(
                unitarioInput.value.replace('.', '').replace(',', '.') || '0'
            ) || 0;
            
            const valorTotal = unitario * total;
            const valorTotalFormatado = formatarMoeda(valorTotal);
            
            const totalInput = document.getElementById(`${prefixo}-empresa${i}-total`);
            if (totalInput) {
                totalInput.value = valorTotalFormatado;
            }
            
            if (valorTotal < menorValor && valorTotal > 0) {
                menorValor = valorTotal;
            }
        }
        
        const menorValorInput = document.getElementById(`${prefixo}-menor-valor`);
        if (menorValorInput) {
            menorValorInput.value = menorValor !== Infinity ? formatarMoeda(menorValor) : 'R$ 0,00';
        }
        
        return menorValor !== Infinity ? menorValor : 0;
    }
    
    // Configurar máscara monetária
    document.querySelectorAll('.valor-monetario').forEach(input => {
        input.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            value = (value / 100).toLocaleString('pt-BR', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
            e.target.value = value;
            
            const id = e.target.id;
            if (id.includes('unitario')) {
                const prefixo = id.split('-')[0];
                calcularTotaisEmpresas(prefixo);
            }
        });
    });

    // Adicionar item ao carrinho
    prefixes.forEach(prefixo => {
        const btnAdicionar = document.getElementById(`${prefixo}-adicionar-carrinho`);
        if (!btnAdicionar) return;
        btnAdicionar.addEventListener('click', function() {
            const cargoOuItem = prefixo === 'srv' 
                ? (document.getElementById(`${prefixo}-cargo`).value === "Outros" 
                    ? document.getElementById(`${prefixo}-outros`).value 
                    : document.getElementById(`${prefixo}-cargo`).value)
                : document.getElementById(`${prefixo}-item`).value;
            const subitem = prefixo !== 'srv' ? document.getElementById(`${prefixo}-subitem`).value : null;
            const codCatmat = prefixo !== 'srv' ? document.getElementById(`${prefixo}-cod-catmat`).value : null;
            const descricao = document.getElementById(`${prefixo}-descricao`).value;
            const quantidade = parseInt(document.getElementById(`${prefixo}-quantidade`).value) || 0;
            const periodo = prefixo === 'me' && document.getElementById('me-tipo').value === 'aquisicao' 
                ? 'aquisicao' 
                : document.getElementById(`${prefixo}-periodo`).value;
            const periodoValor = prefixo === 'me' && document.getElementById('me-tipo').value === 'aquisicao' 
                ? 1 
                : parseInt(document.getElementById(`${prefixo}-periodo-valor`).value) || 0;
            const tipo = prefixo === 'me' ? document.getElementById('me-tipo').value : null;
            const total = tipo === 'aquisicao' ? quantidade : quantidade * periodoValor;

            if (!cargoOuItem || !descricao || quantidade <= 0 || (tipo !== 'aquisicao' && periodoValor <= 0)) {
                alert('Preencha todos os campos obrigatórios!');
                return;
            }

            if (prefixo !== 'srv' && !subitem) {
                alert('Selecione um subitem!');
                return;
            }

            const empresas = [];
            let menorValor = Infinity;
            let empresaSelecionada = null;
            const selecionada = document.querySelector(`input[name="${prefixo}-empresa-selecionada"]:checked`);

            for (let i = 1; i <= 3; i++) {
                const nome = document.getElementById(`${prefixo}-empresa${i}-nome`).value;
                const cnpj = document.getElementById(`${prefixo}-empresa${i}-cnpj`).value;
                const link = document.getElementById(`${prefixo}-empresa${i}-link`).value;
                const unitario = parseFloat(
                    document.getElementById(`${prefixo}-empresa${i}-unitario`).value.replace('.', '').replace(',', '.') || '0'
                ) || 0;
                const valorTotal = unitario * total;

                if (nome && link && valorTotal > 0) {
                    empresas.push({
                        nome,
                        cnpj,
                        link,
                        unitario,
                        total: valorTotal
                    });

                    if (valorTotal < menorValor) {
                        menorValor = valorTotal;
                    }

                    if (selecionada && parseInt(selecionada.value) === i) {
                        empresaSelecionada = {
                            nome,
                            cnpj,
                            link,
                            unitario,
                            total: valorTotal
                        };
                    }
                }
            }

            if (empresas.length === 0) {
                alert('Informe pelo menos uma empresa válida com link!');
                return;
            }

            if (!empresaSelecionada) {
                alert('Selecione uma empresa!');
                return;
            }

            const valorSelecionado = empresaSelecionada.total;
            let justificativa = '';
            if (valorSelecionado > menorValor) {
                justificativa = document.getElementById(`${prefixo}-justificativa`).value;
                if (!justificativa) {
                    alert('Justificativa é obrigatória quando o valor selecionado é maior que o menor valor cotado!');
                    return;
                }
            }

            if (valorGasto + valorSelecionado > valorEmenda) {
                alert('Valor excede o saldo disponível na emenda!');
                return;
            }

            const novoItem = {
                id: Date.now(),
                tipo: prefixo === 'srv' ? 'servicos' : 
                      prefixo === 'me' ? 'material-esportivo' : 
                      prefixo === 'uni' ? 'uniformes' : 
                      prefixo === 'idv' ? 'identidades-divulgacoes' : 'alimentacao',
                cargoOuItem,
                subitem: subitem || null,
                codCatmat: codCatmat || null,
                descricao,
                quantidade,
                periodo,
                periodoValor,
                total,
                empresas,
                empresaSelecionada,
                valor: valorSelecionado,
                justificativa,
                data: new Date(),
                materialTipo: prefixo === 'me' ? tipo : null
            };

            javascript

Copiar
            carrinho.push(novoItem);
            valorGasto += valorSelecionado;

            // Atualizar interface do carrinho
            atualizarCarrinho();

            // Atualizar valores totais
            atualizarValoresTotais();

            // Limpar formulário
            limparFormulario(prefixo);

            console.log(`Item adicionado ao carrinho: ${cargoOuItem}`);
        });
    });

    // Função para formatar valores monetários
    function formatarMoeda(valor) {
        return `R$ ${valor.toLocaleString('pt-BR', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        })}`;
    }

    // Função para atualizar o carrinho na interface
    function atualizarCarrinho() {
        const listaCarrinho = document.getElementById('lista-carrinho');
        const totalCarrinho = document.getElementById('total-carrinho');

        if (carrinho.length === 0) {
            listaCarrinho.innerHTML = '<div class="carrinho-vazio">Nenhum item adicionado ao carrinho</div>';
            totalCarrinho.textContent = 'Total no Carrinho: R$ 0,00';
            return;
        }

        listaCarrinho.innerHTML = carrinho.map(item => {
            const nomeItem = item.subitem ? `${item.cargoOuItem} - ${item.subitem}` : item.cargoOuItem;
            const periodoTexto = item.materialTipo === 'aquisicao' ? '' : `${item.periodoValor} ${item.periodo}`;
            return `
                <div class="item-carrinho" data-id="${item.id}">
                    <div class="item-carrinho-info">
                        <strong>${nomeItem}</strong><br>
                        Descrição: ${item.descricao}<br>
                        Quantidade: ${item.total} ${item.materialTipo ? `(${item.materialTipo})` : ''} ${periodoTexto}<br>
                        Valor: ${formatarMoeda(item.valor)}<br>
                        Empresa: ${item.empresaSelecionada.nome}
                    </div>
                    <div class="item-carrinho-acoes">
                        <button onclick="removerDoCarrinho(${item.id})">Remover</button>
                    </div>
                </div>
            `;
        }).join('');

        totalCarrinho.textContent = `Total no Carrinho: ${formatarMoeda(valorGasto)}`;
    }

    // Função para atualizar valores totais
    function atualizarValoresTotais() {
        document.getElementById('valor-gasto').textContent = formatarMoeda(valorGasto);
        document.getElementById('valor-restante').textContent = formatarMoeda(valorEmenda - valorGasto);
    }

    // Função para limpar formulário após adição
    function limparFormulario(prefixo) {
        if (prefixo === 'srv') {
            document.getElementById(`${prefixo}-cargo`).value = 'Coordenador de eventos';
            document.getElementById(`${prefixo}-outros-container`).style.display = 'none';
            document.getElementById(`${prefixo}-outros`).value = '';
        } else {
            document.getElementById(`${prefixo}-item`).value = '';
            document.getElementById(`${prefixo}-subitem`).value = '';
            document.getElementById(`${prefixo}-cod-catmat`).value = '';
            document.getElementById(`${prefixo}-item-suggestions`).style.display = 'none';
            document.getElementById(`${prefixo}-subitem-suggestions`).style.display = 'none';
        }
        document.getElementById(`${prefixo}-descricao`).value = '';
        document.getElementById(`${prefixo}-quantidade`).value = '1';
        document.getElementById(`${prefixo}-periodo`).value = 'diarias';
        document.getElementById(`${prefixo}-periodo-valor`).value = '1';
        document.getElementById(`${prefixo}-total`).value = '';
        if (prefixo === 'me') {
            document.getElementById('me-tipo').value = 'aquisicao';
            toggleLocacaoFields();
        }
        for (let i = 1; i <= 3; i++) {
            document.getElementById(`${prefixo}-empresa${i}-nome`).value = '';
            document.getElementById(`${prefixo}-empresa${i}-cnpj`).value = '';
            document.getElementById(`${prefixo}-empresa${i}-link`).value = '';
            document.getElementById(`${prefixo}-empresa${i}-unitario`).value = '';
            document.getElementById(`${prefixo}-empresa${i}-total`).value = '';
            document.getElementById(`${prefixo}-empresa${i}-selecionada`).checked = false;
        }
        document.getElementById(`${prefixo}-menor-valor`).value = '';
        document.getElementById(`${prefixo}-justificativa-container`).style.display = 'none';
        document.getElementById(`${prefixo}-justificativa`).value = '';
    }

    // Função para remover item do carrinho
    window.removerDoCarrinho = function(id) {
        const item = carrinho.find(item => item.id === id);
        if (!item) {
            console.error('Item não encontrado no carrinho');
            return;
        }
        valorGasto -= item.valor;
        carrinho = carrinho.filter(item => item.id !== id);
        atualizarCarrinho();
        atualizarValoresTotais();
        console.log(`Item removido do carrinho: ${item.cargoOuItem}`);
    }

    // Função para exportar carrinho para Excel
    document.getElementById('btn-exportar-excel').addEventListener('click', function() {
        if (!declaracaoCheckbox.checked) {
            console.error('A declaração deve ser aceita para exportar o Excel');
            return;
        }

        if (carrinho.length === 0) {
            console.error('Carrinho vazio. Adicione itens antes de exportar.');
            return;
        }

        const dataExportacao = carrinho.map(item => ({
            Tipo: item.tipo,
            Item: item.cargoOuItem,
            Subitem: item.subitem || '-',
            'Cód. CATMAT/CATSER/CBO': item.codCatmat || '-',
            Descrição: item.descricao,
            Quantidade: item.quantidade,
            Período: item.materialTipo === 'aquisicao' ? '-' : item.periodo,
            'Valor do Período': item.materialTipo === 'aquisicao' ? '-' : item.periodoValor,
            Total: item.total,
            'Empresa Selecionada': item.empresaSelecionada.nome,
            'CNPJ': item.empresaSelecionada.cnpj || '-',
            'Link': item.empresaSelecionada.link,
            'Valor Unitário (R$)': item.empresaSelecionada.unitario,
            'Valor Total (R$)': item.valor,
            Justificativa: item.justificativa || '-',
            'Data': item.data.toLocaleDateString('pt-BR')
        }));

        const ws = XLSX.utils.json_to_sheet(dataExportacao);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, 'Precificação');
        XLSX.write(wb, `Precificacao_Emenda_${numeroProposta}.xlsx`);
        console.log('Arquivo Excel gerado com sucesso');
    });

    // Função para finalizar precificação
    document.getElementById('btn-finalizar').addEventListener('click', function() {
        if (carrinho.length === 0) {
            console.error('Carrinho vazio. Adicione itens antes de finalizar.');
            return;
        }

        if (!declaracaoCheckbox.checked) {
            console.error('A declaração deve ser aceita para finalizar a precificação');
            return;
        }

        // Exibir mensagem de sucesso (na interface, não em pop-up)
        const carrinhoDiv = document.querySelector('.carrinho');
        const mensagemSucesso = document.createElement('div');
        mensagemSucesso.className = 'mensagem-sucesso';
        mensagemSucesso.style.color = '#28a745';
        mensagemSucesso.style.marginTop = '10px';
        mensagemSucesso.textContent = 'Precificação finalizada com sucesso!';
        carrinhoDiv.appendChild(mensagemSucesso);

        // Desabilitar botões para evitar alterações
        document.getElementById('btn-finalizar').disabled = true;
        document.getElementById('btn-exportar-excel').disabled = true;
        prefixes.forEach(prefixo => {
            const btnAdicionar = document.getElementById(`${prefixo}-adicionar-carrinho`);
            if (btnAdicionar) btnAdicionar.disabled = true;
        });

        console.log('Precificação finalizada');
    });

    // Inicializar valores totais
    atualizarValoresTotais();
});
</script>
</body>
</html>