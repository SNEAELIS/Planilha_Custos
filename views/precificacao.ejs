<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Precificação de Emendas - Ministério do Esporte</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: #333;
        }

        .header {
            background-color: #003366;
            color: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .logo {
            height: 50px;
        }

        .container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        h1, h2 {
            color: #003366;
            margin-bottom: 20px;
            text-align: center;
        }

        .resumo-valores {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 30px;
            border-left: 4px solid #003366;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
        }

        .resumo-valores p {
            margin: 5px 0;
            min-width: 200px;
        }

        .resumo-valores span {
            font-weight: bold;
            color: #003366;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: 1px solid transparent;
            border-bottom: none;
            border-radius: 4px 4px 0 0;
            margin-right: 5px;
            background-color: #f1f1f1;
        }

        .tab.active {
            background-color: white;
            border-color: #ddd;
            border-bottom-color: white;
            color: #003366;
            font-weight: bold;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .formulario-item {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #003366;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }

        .empresas-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .empresa {
            background-color: white;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        .empresa h4 {
            margin-bottom: 10px;
            color: #003366;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }

        .btn {
            background-color: #003366;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
            margin-top: 10px;
        }

        .btn:hover {
            background-color: #002244;
        }

        .btn-secondary {
            background-color: #6c757d;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
        }

        .btn-success {
            background-color: #28a745;
        }

        .btn-success:hover {
            background-color: #218838;
        }

        .carrinho {
            margin-top: 30px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 4px;
        }

        .carrinho h3 {
            color: #003366;
            margin-bottom: 15px;
        }

        .carrinho-vazio {
            text-align: center;
            color: #666;
            padding: 20px;
        }

        .item-carrinho {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid #eee;
            align-items: center;
        }

        .item-carrinho-info {
            flex: 1;
        }

        .item-carrinho-acoes button {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            margin-left: 10px;
        }

        .total-carrinho {
            text-align: right;
            margin-top: 15px;
            font-weight: bold;
            font-size: 18px;
        }

        .acoes-carrinho {
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
            gap: 10px;
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            padding: 15px;
            color: #666;
            font-size: 14px;
        }

        .suggestions {
            position: absolute;
            background: white;
            border: 1px solid #ddd;
            max-height: 200px;
            overflow-y: auto;
            width: 100%;
            z-index: 1000;
        }

        .suggestion-item {
            padding: 10px;
            cursor: pointer;
        }

        .suggestion-item:hover {
            background-color: #f0f0f0;
        }

        @media (max-width: 768px) {
            .container {
                margin: 15px;
                padding: 15px;
            }
            
            .empresas-container {
                grid-template-columns: 1fr;
            }
            
            .resumo-valores {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <img src="logo-ministerio-esporte.png" alt="Ministério do Esporte" class="logo">
        <h2>Sistema de Precificação de Emendas</h2>
    </header>

    <div class="container">
        <h1>Precificação de Itens</h1>
        
        <div class="resumo-valores">
            <p><span>Valor Total da Emenda:</span> <strong id="valor-total">R$ 0,00</strong></p>
            <p><span>Valor Gasto:</span> <strong id="valor-gasto">R$ 0,00</strong></p>
            <p><span>Valor Restante:</span> <strong id="valor-restante">R$ 0,00</strong></p>
        </div>

        <div class="tabs">
            <div class="tab active" data-tab="servicos">Serviços/Recursos Humanos</div>
            <div class="tab" data-tab="material-esportivo">Material Esportivo</div>
            <div class="tab" data-tab="uniformes">Uniformes</div>
            <div class="tab" data-tab="identidades-divulgacoes">Identidades/Divulgações</div>
            <div class="tab" data-tab="alimentacao">Alimentação</div>
        </div>

        <!-- Formulário Serviços -->
        <div id="servicos" class="tab-content active">
            <div class="formulario-item">
                <h2>Adicionar Item - Recursos Humanos</h2>
                
                <div class="form-group">
                    <label for="rh-cargo">Cargo</label>
                    <select id="rh-cargo" onchange="toggleOutrosField('rh')">
                        <option value="Coordenador de eventos">Coordenador de eventos</option>
                        <option value="Coordenador de projetos sociais">Coordenador de projetos sociais</option>
                        <option value="Analista de marketing">Analista de marketing</option>
                        <option value="Consultor de sistemas de TI">Consultor de sistemas de TI</option>
                        <option value="Fisioterapeuta esportivo">Fisioterapeuta esportivo</option>
                        <option value="Preparador físico">Preparador físico</option>
                        <option value="Coordenador pedagógico">Coordenador pedagógico</option>
                        <option value="Assessor jurídico">Assessor jurídico</option>
                        <option value="Consultor jurídico">Consultor jurídico</option>
                        <option value="Assistente social">Assistente social</option>
                        <option value="Consultor administrativo">Consultor administrativo</option>
                        <option value="Contador">Contador</option>
                        <option value="Assessor de imprensa">Assessor de imprensa</option>
                        <option value="Locutor esportivo">Locutor esportivo</option>
                        <option value="Fotógrafo">Fotógrafo</option>
                        <option value="Tecnólogo em produção audiovisual">Tecnólogo em produção audiovisual</option>
                        <option value="Tecnólogo em produção multimídia">Tecnólogo em produção multimídia</option>
                        <option value="Desenhista de identidade visual">Desenhista de identidade visual</option>
                        <option value="Técnico de apoio ao usuário de informática (helpdesk)">Técnico de apoio ao usuário de informática (helpdesk)</option>
                        <option value="Técnico de suporte de TI">Técnico de suporte de TI</option>
                        <option value="Instrutor de cursos livres">Instrutor de cursos livres</option>
                        <option value="Operador de áudio">Operador de áudio</option>
                        <option value="Editor de TV e vídeo">Editor de TV e vídeo</option>
                        <option value="Coordenador administrativo">Coordenador administrativo</option>
                        <option value="Auxiliar administrativo">Auxiliar administrativo</option>
                        <option value="Assistente administrativo">Assistente administrativo</option>
                        <option value="Recepcionista, em geral">Recepcionista, em geral</option>
                        <option value="Auxiliar de limpeza">Auxiliar de limpeza</option>
                        <option value="Bombeiro civil">Bombeiro civil</option>
                        <option value="Segurança de evento">Segurança de evento</option>
                        <option value="Outros">Outros</option>
                    </select>
                </div>
                <div class="form-group" id="rh-outros-container" style="display: none;">
                    <label for="rh-outros">Especifique o Cargo</label>
                    <input type="text" id="rh-outros" placeholder="Digite o cargo">
                </div>
                
                <div class="form-group">
                    <label for="srv-descricao">Descrição do Serviço/Método de Cálculo</label>
                    <textarea id="srv-descricao" placeholder="Ex: PROFESSOR - Responsável pela preparação e execução das aulas"></textarea>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                    <div class="form-group">
                        <label for="srv-quantidade">Quantidade</label>
                        <input type="number" id="srv-quantidade" min="1" value="1">
                    </div>
                    
                    <div class="form-group">
                        <label for="rh-periodo">Diárias/Meses</label>
                        <select id="rh-periodo">
                            <option value="diarias">Diárias</option>
                            <option value="meses">Meses</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="rh-periodo-valor">Valor do Período</label>
                        <input type="number" id="rh-periodo-valor" min="1" value="1">
                    </div>
                    
                    <div class="form-group">
                        <label for="srv-total">Total</label>
                        <input type="text" id="srv-total" readonly>
                    </div>
                </div>
                
                <h3 style="margin-top: 20px;">Empresas Cotadas</h3>
                <div class="empresas-container">
                    <!-- Empresa 1 -->
                    <div class="empresa">
                        <h4>Empresa 1</h4>
                        <div class="form-group">
                            <label for="srv-empresa1-nome">Nome</label>
                            <input type="text" id="srv-empresa1-nome" placeholder="Nome da empresa">
                        </div>
                        <div class="form-group">
                            <label for="rh-empresa1-cnpj">CNPJ</label>
                            <input type="text" id="rh-empresa1-cnpj" placeholder="XX.XXX.XXX/XXXX-XX">
                        </div>
                        <div class="form-group">
                            <label for="rh-empresa1-link">Link (obrigatório)</label>
                            <input type="url" id="rh-empresa1-link" placeholder="https://..." required>
                        </div>
                        <div class="form-group">
                            <label for="srv-empresa1-unitario">Valor Unitário (R$)</label>
                            <input type="text" id="srv-empresa1-unitario" class="valor-monetario" placeholder="0,00">
                        </div>
                        <div class="form-group">
                            <label for="srv-empresa1-total">Valor Total (R$)</label>
                            <input type="text" id="srv-empresa1-total" readonly>
                        </div>
                        <div class="form-group">
                            <label for="rh-empresa1-selecionada">Selecionar Empresa</label>
                            <input type="radio" name="rh-empresa-selecionada" id="rh-empresa1-selecionada" value="1" onchange="mostrarJustificativa('rh', 1)">
                        </div>
                    </div>
                    
                    <!-- Empresa 2 -->
                    <div class="empresa">
                        <h4>Empresa 2</h4>
                        <div class="form-group">
                            <label for="srv-empresa2-nome">Nome</label>
                            <input type="text" id="srv-empresa2-nome" placeholder="Nome da empresa">
                        </div>
                        <div class="form-group">
                            <label for="rh-empresa2-cnpj">CNPJ</label>
                            <input type="text" id="rh-empresa2-cnpj" placeholder="XX.XXX.XXX/XXXX-XX">
                        </div>
                        <div class="form-group">
                            <label for="rh-empresa2-link">Link (obrigatório)</label>
                            <input type="url" id="rh-empresa2-link" placeholder="https://..." required>
                        </div>
                        <div class="form-group">
                            <label for="srv-empresa2-unitario">Valor Unitário (R$)</label>
                            <input type="text" id="srv-empresa2-unitario" class="valor-monetario" placeholder="0,00">
                        </div>
                        <div class="form-group">
                            <label for="srv-empresa2-total">Valor Total (R$)</label>
                            <input type="text" id="srv-empresa2-total" readonly>
                        </div>
                        <div class="form-group">
                            <label for="rh-empresa2-selecionada">Selecionar Empresa</label>
                            <input type="radio" name="rh-empresa-selecionada" id="rh-empresa2-selecionada" value="2" onchange="mostrarJustificativa('rh', 2)">
                        </div>
                    </div>
                    
                    <!-- Empresa 3 -->
                    <div class="empresa">
                        <h4>Empresa 3</h4>
                        <div class="form-group">
                            <label for="srv-empresa3-nome">Nome</label>
                            <input type="text" id="srv-empresa3-nome" placeholder="Nome da empresa">
                        </div>
                        <div class="form-group">
                            <label for="rh-empresa3-cnpj">CNPJ</label>
                            <input type="text" id="rh-empresa3-cnpj" placeholder="XX.XXX.XXX/XXXX-XX">
                        </div>
                        <div class="form-group">
                            <label for="rh-empresa3-link">Link (obrigatório)</label>
                            <input type="url" id="rh-empresa3-link" placeholder="https://..." required>
                        </div>
                        <div class="form-group">
                            <label for="srv-empresa3-unitario">Valor Unitário (R$)</label>
                            <input type="text" id="srv-empresa3-unitario" class="valor-monetario" placeholder="0,00">
                        </div>
                        <div class="form-group">
                            <label for="srv-empresa3-total">Valor Total (R$)</label>
                            <input type="text" id="srv-empresa3-total" readonly>
                        </div>
                        <div class="form-group">
                            <label for="rh-empresa3-selecionada">Selecionar Empresa</label>
                            <input type="radio" name="rh-empresa-selecionada" id="rh-empresa3-selecionada" value="3" onchange="mostrarJustificativa('rh', 3)">
                        </div>
                    </div>
                </div>
                
                <div class="form-group" style="margin-top: 20px;">
                    <label for="srv-menor-valor">Menor Valor Cotado (R$)</label>
                    <input type="text" id="srv-menor-valor" readonly>
                </div>
                
                <div class="form-group" id="rh-justificativa-container" style="display: none;">
                    <label for="rh-justificativa">Justificativa</label>
                    <textarea id="rh-justificativa" placeholder="Justifique a escolha de uma empresa com valor superior ao menor cotado"></textarea>
                </div>
                
                <button class="btn btn-success" id="srv-adicionar-carrinho">Adicionar ao Carrinho</button>
            </div>
        </div>

        <!-- Formulário Material Esportivo -->
        <div id="material-esportivo" class="tab-content">
            <div class="formulario-item">
                <h2>Adicionar Item - Material Esportivo</h2>
                
                <div class="form-group">
                    <label for="me-item">Item</label>
                    <input type="text" id="me-item" placeholder="Digite o item">
                </div>
                
                <div class="form-group">
                    <label for="me-tipo">Tipo</label>
                    <select id="me-tipo" onchange="toggleLocacaoFields()">
                        <option value="aquisicao">Aquisição</option>
                        <option value="locacao">Locação</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="me-descricao">Descrição do Item/Método de Cálculo</label>
                    <textarea id="me-descricao" placeholder="Ex: BOLA DE FUTEBOL - Utilizada para atividades esportivas"></textarea>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                    <div class="form-group">
                        <label for="me-quantidade">Quantidade</label>
                        <input type="number" id="me-quantidade" min="1" value="1">
                    </div>
                    
                    <div class="form-group" id="me-periodo-container">
                        <label for="me-periodo">Diárias/Meses</label>
                        <select id="me-periodo">
                            <option value="diarias">Diárias</option>
                            <option value="meses">Meses</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="me-periodo-valor-container">
                        <label for="me-periodo-valor">Valor do Período</label>
                        <input type="number" id="me-periodo-valor" min="1" value="1">
                    </div>
                    
                    <div class="form-group">
                        <label for="me-total">Total</label>
                        <input type="text" id="me-total" readonly>
                    </div>
                </div>
                
                <h3 style="margin-top: 20px;">Empresas Cotadas</h3>
                <div class="empresas-container">
                    <!-- Empresa 1 -->
                    <div class="empresa">
                        <h4>Empresa 1</h4>
                        <div class="form-group">
                            <label for="me-empresa1-nome">Nome</label>
                            <input type="text" id="me-empresa1-nome" placeholder="Nome da empresa">
                        </div>
                        <div class="form-group">
                            <label for="me-empresa1-cnpj">CNPJ</label>
                            <input type="text" id="me-empresa1-cnpj" placeholder="XX.XXX.XXX/XXXX-XX">
                        </div>
                        <div class="form-group">
                            <label for="me-empresa1-link">Link (obrigatório)</label>
                            <input type="url" id="me-empresa1-link" placeholder="https://..." required>
                        </div>
                        <div class="form-group">
                            <label for="me-empresa1-unitario">Valor Unitário (R$)</label>
                            <input type="text" id="me-empresa1-unitario" class="valor-monetario" placeholder="0,00">
                        </div>
                        <div class="form-group">
                            <label for="me-empresa1-total">Valor Total (R$)</label>
                            <input type="text" id="me-empresa1-total" readonly>
                        </div>
                        <div class="form-group">
                            <label for="me-empresa1-selecionada">Selecionar Empresa</label>
                            <input type="radio" name="me-empresa-selecionada" id="me-empresa1-selecionada" value="1" onchange="mostrarJustificativa('me', 1)">
                        </div>
                    </div>
                    
                    <!-- Empresa 2 -->
                    <div class="empresa">
                        <h4>Empresa 2</h4>
                        <div class="form-group">
                            <label for="me-empresa2-nome">Nome</label>
                            <input type="text" id="me-empresa2-nome" placeholder="Nome da empresa">
                        </div>
                        <div class="form-group">
                            <label for="me-empresa2-cnpj">CNPJ</label>
                            <input type="text" id="me-empresa2-cnpj" placeholder="XX.XXX.XXX/XXXX-XX">
                        </div>
                        <div class="form-group">
                            <label for="me-empresa2-link">Link (obrigatório)</label>
                            <input type="url" id="me-empresa2-link" placeholder="https://..." required>
                        </div>
                        <div class="form-group">
                            <label for="me-empresa2-unitario">Valor Unitário (R$)</label>
                            <input type="text" id="me-empresa2-unitario" class="valor-monetario" placeholder="0,00">
                        </div>
                        <div class="form-group">
                            <label for="me-empresa2-total">Valor Total (R$)</label>
                            <input type="text" id="me-empresa2-total" readonly>
                        </div>
                        <div class="form-group">
                            <label for="me-empresa2-selecionada">Selecionar Empresa</label>
                            <input type="radio" name="me-empresa-selecionada" id="me-empresa2-selecionada" value="2" onchange="mostrarJustificativa('me', 2)">
                        </div>
                    </div>
                    
                    <!-- Empresa 3 -->
                    <div class="empresa">
                        <h4>Empresa 3</h4>
                        <div class="form-group">
                            <label for="me-empresa3-nome">Nome</label>
                            <input type="text" id="me-empresa3-nome" placeholder="Nome da empresa">
                        </div>
                        <div class="form-group">
                            <label for="me-empresa3-cnpj">CNPJ</label>
                            <input type="text" id="me-empresa3-cnpj" placeholder="XX.XXX.XXX/XXXX-XX">
                        </div>
                        <div class="form-group">
                            <label for="me-empresa3-link">Link (obrigatório)</label>
                            <input type="url" id="me-empresa3-link" placeholder="https://..." required>
                        </div>
                        <div class="form-group">
                            <label for="me-empresa3-unitario">Valor Unitário (R$)</label>
                            <input type="text" id="me-empresa3-unitario" class="valor-monetario" placeholder="0,00">
                        </div>
                        <div class="form-group">
                            <label for="me-empresa3-total">Valor Total (R$)</label>
                            <input type="text" id="me-empresa3-total" readonly>
                        </div>
                        <div class="form-group">
                            <label for="me-empresa3-selecionada">Selecionar Empresa</label>
                            <input type="radio" name="me-empresa-selecionada" id="me-empresa3-selecionada" value="3" onchange="mostrarJustificativa('me', 3)">
                        </div>
                    </div>
                </div>
                
                <div class="form-group" style="margin-top: 20px;">
                    <label for="me-menor-valor">Menor Valor Cotado (R$)</label>
                    <input type="text" id="me-menor-valor" readonly>
                </div>
                
                <div class="form-group" id="me-justificativa-container" style="display: none;">
                    <label for="me-justificativa">Justificativa</label>
                    <textarea id="me-justificativa" placeholder="Justifique a escolha de uma empresa com valor superior ao menor cotado"></textarea>
                </div>
                
                <button class="btn btn-success" id="me-adicionar-carrinho">Adicionar ao Carrinho</button>
            </div>
        </div>

        <!-- Formulário Uniformes -->
        <div id="uniformes" class="tab-content">
            <div class="formulario-item">
                <h2>Adicionar Item - Uniformes</h2>
                
                <div class="form-group">
                    <label for="uni-item">Item</label>
                    <input type="text" id="uni-item" placeholder="Digite o item">
                </div>
                
                <div class="form-group">
                    <label for="uni-descricao">Descrição do Item/Método de Cálculo</label>
                    <textarea id="uni-descricao" placeholder="Ex: CAMISETA ESPORTIVA - Uniforme para os atletas"></textarea>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                    <div class="form-group">
                        <label for="uni-quantidade">Quantidade</label>
                        <input type="number" id="uni-quantidade" min="1" value="1">
                    </div>
                    
                    <div class="form-group">
                        <label for="uni-periodo">Diárias/Meses</label>
                        <select id="uni-periodo">
                            <option value="diarias">Diárias</option>
                            <option value="meses">Meses</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="uni-periodo-valor">Valor do Período</label>
                        <input type="number" id="uni-periodo-valor" min="1" value="1">
                    </div>
                    
                    <div class="form-group">
                        <label for="uni-total">Total</label>
                        <input type="text" id="uni-total" readonly>
                    </div>
                </div>
                
                <h3 style="margin-top: 20px;">Empresas Cotadas</h3>
                <div class="empresas-container">
                    <!-- Empresa 1 -->
                    <div class="empresa">
                        <h4>Empresa 1</h4>
                        <div class="form-group">
                            <label for="uni-empresa1-nome">Nome</label>
                            <input type="text" id="uni-empresa1-nome" placeholder="Nome da empresa">
                        </div>
                        <div class="form-group">
                            <label for="uni-empresa1-cnpj">CNPJ</label>
                            <input type="text" id="uni-empresa1-cnpj" placeholder="XX.XXX.XXX/XXXX-XX">
                        </div>
                        <div class="form-group">
                            <label for="uni-empresa1-link">Link (obrigatório)</label>
                            <input type="url" id="uni-empresa1-link" placeholder="https://..." required>
                        </div>
                        <div class="form-group">
                            <label for="uni-empresa1-unitario">Valor Unitário (R$)</label>
                            <input type="text" id="uni-empresa1-unitario" class="valor-monetario" placeholder="0,00">
                        </div>
                        <div class="form-group">
                            <label for="uni-empresa1-total">Valor Total (R$)</label>
                            <input type="text" id="uni-empresa1-total" readonly>
                        </div>
                        <div class="form-group">
                            <label for="uni-empresa1-selecionada">Selecionar Empresa</label>
                            <input type="radio" name="uni-empresa-selecionada" id="uni-empresa1-selecionada" value="1" onchange="mostrarJustificativa('uni', 1)">
                        </div>
                    </div>
                    
                    <!-- Empresa 2 -->
                    <div class="empresa">
                        <h4>Empresa 2</h4>
                        <div class="form-group">
                            <label for="uni-empresa2-nome">Nome</label>
                            <input type="text" id="uni-empresa2-nome" placeholder="Nome da empresa">
                        </div>
                        <div class="form-group">
                            <label for="uni-empresa2-cnpj">CNPJ</label>
                            <input type="text" id="uni-empresa2-cnpj" placeholder="XX.XXX.XXX/XXXX-XX">
                        </div>
                        <div class="form-group">
                            <label for="uni-empresa2-link">Link (obrigatório)</label>
                            <input type="url" id="uni-empresa2-link" placeholder="https://..." required>
                        </div>
                        <div class="form-group">
                            <label for="uni-empresa2-unitario">Valor Unitário (R$)</label>
                            <input type="text" id="uni-empresa2-unitario" class="valor-monetario" placeholder="0,00">
                        </div>
                        <div class="form-group">
                            <label for="uni-empresa2-total">Valor Total (R$)</label>
                            <input type="text" id="uni-empresa2-total" readonly>
                        </div>
                        <div class="form-group">
                            <label for="uni-empresa2-selecionada">Selecionar Empresa</label>
                            <input type="radio" name="uni-empresa-selecionada" id="uni-empresa2-selecionada" value="2" onchange="mostrarJustificativa('uni', 2)">
                        </div>
                    </div>
                    
                    <!-- Empresa 3 -->
                    <div class="empresa">
                        <h4>Empresa 3</h4>
                        <div class="form-group">
                            <label for="uni-empresa3-nome">Nome</label>
                            <input type="text" id="uni-empresa3-nome" placeholder="Nome da empresa">
                        </div>
                        <div class="form-group">
                            <label for="uni-empresa3-cnpj">CNPJ</label>
                            <input type="text" id="uni-empresa3-cnpj" placeholder="XX.XXX.XXX/XXXX-XX">
                        </div>
                        <div class="form-group">
                            <label for="uni-empresa3-link">Link (obrigatório)</label>
                            <input type="url" id="uni-empresa3-link" placeholder="https://..." required>
                        </div>
                        <div class="form-group">
                            <label for="uni-empresa3-unitario">Valor Unitário (R$)</label>
                            <input type="text" id="uni-empresa3-unitario" class="valor-monetario" placeholder="0,00">
                        </div>
                        <div class="form-group">
                            <label for="uni-empresa3-total">Valor Total (R$)</label>
                            <input type="text" id="uni-empresa3-total" readonly>
                        </div>
                        <div class="form-group">
                            <label for="uni-empresa3-selecionada">Selecionar Empresa</label>
                            <input type="radio" name="uni-empresa-selecionada" id="uni-empresa3-selecionada" value="3" onchange="mostrarJustificativa('uni', 3)">
                        </div>
                    </div>
                </div>
                
                <div class="form-group" style="margin-top: 20px;">
                    <label for="uni-menor-valor">Menor Valor Cotado (R$)</label>
                    <input type="text" id="uni-menor-valor" readonly>
                </div>
                
                <div class="form-group" id="uni-justificativa-container" style="display: none;">
                    <label for="uni-justificativa">Justificativa</label>
                    <textarea id="uni-justificativa" placeholder="Justifique a escolha de uma empresa com valor superior ao menor cotado"></textarea>
                </div>
                
                <button class="btn btn-success" id="uni-adicionar-carrinho">Adicionar ao Carrinho</button>
            </div>
        </div>

        <!-- Formulário Identidades/Divulgações -->
        <div id="identidades-divulgacoes" class="tab-content">
            <div class="formulario-item">
                <h2>Adicionar Item - Identidades/Divulgações</h2>
                
                <div class="form-group">
                    <label for="idv-item">Item</label>
                    <input type="text" id="idv-item" placeholder="Digite para buscar um item" oninput="filtrarItens('idv')" autocomplete="off">
                    <div id="idv-item-suggestions" class="suggestions" style="display: none;"></div>
                </div>
                
                <div class="form-group">
                    <label for="idv-subitem">Subitem</label>
                    <input type="text" id="idv-subitem" placeholder="Digite para buscar um subitem" oninput="filtrarSubitens('idv')" autocomplete="off">
                    <div id="idv-subitem-suggestions" class="suggestions" style="display: none;"></div>
                </div>
                
                <div class="form-group">
                    <label for="idv-descricao">Descrição do Item/Método de Cálculo</label>
                    <textarea id="idv-descricao" placeholder="Ex: BANNER PROMOCIONAL - Material de divulgação do evento"></textarea>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                    <div class="form-group">
                        <label for="idv-quantidade">Quantidade</label>
                        <input type="number" id="idv-quantidade" min="1" value="1">
                    </div>
                    
                    <div class="form-group">
                        <label for="idv-periodo">Diárias/Meses</label>
                        <select id="idv-periodo">
                            <option value="diarias">Diárias</option>
                            <option value="meses">Meses</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="idv-periodo-valor">Valor do Período</label>
                        <input type="number" id="idv-periodo-valor" min="1" value="1">
                    </div>
                    
                    <div class="form-group">
                        <label for="idv-total">Total</label>
                        <input type="text" id="idv-total" readonly>
                    </div>
                </div>
                
                <h3 style="margin-top: 20px;">Empresas Cotadas</h3>
                <div class="empresas-container">
                    <!-- Empresa 1 -->
                    <div class="empresa">
                        <h4>Empresa 1</h4>
                        <div class="form-group">
                            <label for="idv-empresa1-nome">Nome</label>
                            <input type="text" id="idv-empresa1-nome" placeholder="Nome da empresa">
                        </div>
                        <div class="form-group">
                            <label for="idv-empresa1-cnpj">CNPJ</label>
                            <input type="text" id="idv-empresa1-cnpj" placeholder="XX.XXX.XXX/XXXX-XX">
                        </div>
                        <div class="form-group">
                            <label for="idv-empresa1-link">Link (obrigatório)</label>
                            <input type="url" id="idv-empresa1-link" placeholder="https://..." required>
                        </div>
                        <div class="form-group">
                            <label for="idv-empresa1-unitario">Valor Unitário (R$)</label>
                            <input type="text" id="idv-empresa1-unitario" class="valor-monetario" placeholder="0,00">
                        </div>
                        <div class="form-group">
                            <label for="idv-empresa1-total">Valor Total (R$)</label>
                            <input type="text" id="idv-empresa1-total" readonly>
                        </div>
                        <div class="form-group">
                            <label for="idv-empresa1-selecionada">Selecionar Empresa</label>
                            <input type="radio" name="idv-empresa-selecionada" id="idv-empresa1-selecionada" value="1" onchange="mostrarJustificativa('idv', 1)">
                        </div>
                    </div>
                    
                    <!-- Empresa 2 -->
                    <div class="empresa">
                        <h4>Empresa 2</h4>
                        <div class="form-group">
                            <label for="idv-empresa2-nome">Nome</label>
                            <input type="text" id="idv-empresa2-nome" placeholder="Nome da empresa">
                        </div>
                        <div class="form-group">
                            <label for="idv-empresa2-cnpj">CNPJ</label>
                            <input type="text" id="idv-empresa2-cnpj" placeholder="XX.XXX.XXX/XXXX-XX">
                        </div>
                        <div class="form-group">
                            <label for="idv-empresa2-link">Link (obrigatório)</label>
                            <input type="url" id="idv-empresa2-link" placeholder="https://..." required>
                        </div>
                        <div class="form-group">
                            <label for="idv-empresa2-unitario">Valor Unitário (R$)</label>
                            <input type="text" id="idv-empresa2-unitario" class="valor-monetario" placeholder="0,00">
                        </div>
                        <div class="form-group">
                            <label for="idv-empresa2-total">Valor Total (R$)</label>
                            <input type="text" id="idv-empresa2-total" readonly>
                        </div>
                        <div class="form-group">
                            <label for="idv-empresa2-selecionada">Selecionar Empresa</label>
                            <input type="radio" name="idv-empresa-selecionada" id="idv-empresa2-selecionada" value="2" onchange="mostrarJustificativa('idv', 2)">
                        </div>
                    </div>
                    
                    <!-- Empresa 3 -->
                    <div class="empresa">
                        <h4>Empresa 3</h4>
                        <div class="form-group">
                            <label for="idv-empresa3-nome">Nome</label>
                            <input type="text" id="idv-empresa3-nome" placeholder="Nome da empresa">
                        </div>
                        <div class="form-group">
                            <label for="idv-empresa3-cnpj">CNPJ</label>
                            <input type="text" id="idv-empresa3-cnpj" placeholder="XX.XXX.XXX/XXXX-XX">
                        </div>
                        <div class="form-group">
                            <label for="idv-empresa3-link">Link (obrigatório)</label>
                            <input type="url" id="idv-empresa3-link" placeholder="https://..." required>
                        </div>
                        <div class="form-group">
                            <label for="idv-empresa3-unitario">Valor Unitário (R$)</label>
                            <input type="text" id="idv-empresa3-unitario" class="valor-monetario" placeholder="0,00">
                        </div>
                        <div class="form-group">
                            <label for="idv-empresa3-total">Valor Total (R$)</label>
                            <input type="text" id="idv-empresa3-total" readonly>
                        </div>
                        <div class="form-group">
                            <label for="idv-empresa3-selecionada">Selecionar Empresa</label>
                            <input type="radio" name="idv-empresa-selecionada" id="idv-empresa3-selecionada" value="3" onchange="mostrarJustificativa('idv', 3)">
                        </div>
                    </div>
                </div>
                
                <div class="form-group" style="margin-top: 20px;">
                    <label for="idv-menor-valor">Menor Valor Cotado (R$)</label>
                    <input type="text" id="idv-menor-valor" readonly>
                </div>
                
                <div class="form-group" id="idv-justificativa-container" style="display: none;">
                    <label for="idv-justificativa">Justificativa</label>
                    <textarea id="idv-justificativa" placeholder="Justifique a escolha de uma empresa com valor superior ao menor cotado"></textarea>
                </div>
                
                <button class="btn btn-success" id="idv-adicionar-carrinho">Adicionar ao Carrinho</button>
            </div>
        </div>

        <!-- Formulário Alimentação -->
        <div id="alimentacao" class="tab-content">
            <div class="formulario-item">
                <h2>Adicionar Item - Alimentação</h2>
                
                <div class="form-group">
                    <label for="ali-item">Item</label>
                    <input type="text" id="ali-item" placeholder="Digite para buscar um item" oninput="filtrarItens('ali')" autocomplete="off">
                    <div id="ali-item-suggestions" class="suggestions" style="display: none;"></div>
                </div>
                
                <div class="form-group">
                    <label for="ali-subitem">Subitem</label>
                    <input type="text" id="ali-subitem" placeholder="Digite para buscar um subitem" oninput="filtrarSubitens('ali')" autocomplete="off">
                    <div id="ali-subitem-suggestions" class="suggestions" style="display: none;"></div>
                </div>
                
                <div class="form-group">
                    <label for="ali-descricao">Descrição do Item/Método de Cálculo</label>
                    <textarea id="ali-descricao" placeholder="Ex: REFEIÇÃO COMPLETA - Almoço para participantes do evento"></textarea>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                    <div class="form-group">
                        <label for="ali-quantidade">Quantidade</label>
                        <input type="number" id="ali-quantidade" min="1" value="1">
                    </div>
                    
                    <div class="form-group">
                        <label for="ali-periodo">Diárias/Meses</label>
                        <select id="ali-periodo">
                            <option value="diarias">Diárias</option>
                            <option value="meses">Meses</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="ali-periodo-valor">Valor do Período</label>
                        <input type="number" id="ali-periodo-valor" min="1" value="1">
                    </div>
                    
                    <div class="form-group">
                        <label for="ali-total">Total</label>
                        <input type="text" id="ali-total" readonly>
                    </div>
                </div>
                
                <h3 style="margin-top: 20px;">Empresas Cotadas</h3>
                <div class="empresas-container">
                    <!-- Empresa 1 -->
                    <div class="empresa">
                        <h4>Empresa 1</h4>
                        <div class="form-group">
                            <label for="ali-empresa1-nome">Nome</label>
                            <input type="text" id="ali-empresa1-nome" placeholder="Nome da empresa">
                        </div>
                        <div class="form-group">
                            <label for="ali-empresa1-cnpj">CNPJ</label>
                            <input type="text" id="ali-empresa1-cnpj" placeholder="XX.XXX.XXX/XXXX-XX">
                        </div>
                        <div class="form-group">
                            <label for="ali-empresa1-link">Link (obrigatório)</label>
                            <input type="url" id="ali-empresa1-link" placeholder="https://..." required>
                        </div>
                        <div class="form-group">
                            <label for="ali-empresa1-unitario">Valor Unitário (R$)</label>
                            <input type="text" id="ali-empresa1-unitario" class="valor-monetario" placeholder="0,00">
                        </div>
                        <div class="form-group">
                            <label for="ali-empresa1-total">Valor Total (R$)</label>
                            <input type="text" id="ali-empresa1-total" readonly>
                        </div>
                        <div class="form-group">
                            <label for="ali-empresa1-selecionada">Selecionar Empresa</label>
                            <input type="radio" name="ali-empresa-selecionada" id="ali-empresa1-selecionada" value="1" onchange="mostrarJustificativa('ali', 1)">
                        </div>
                    </div>
                    
                    <!-- Empresa 2 -->
                    <div class="empresa">
                        <h4>Empresa 2</h4>
                        <div class="form-group">
                            <label for="ali-empresa2-nome">Nome</label>
                            <input type="text" id="ali-empresa2-nome" placeholder="Nome da empresa">
                        </div>
                        <div class="form-group">
                            <label for="ali-empresa2-cnpj">CNPJ</label>
                            <input type="text" id="ali-empresa2-cnpj" placeholder="XX.XXX.XXX/XXXX-XX">
                        </div>
                        <div class="form-group">
                            <label for="ali-empresa2-link">Link (obrigatório)</label>
                            <input type="url" id="ali-empresa2-link" placeholder="https://..." required>
                        </div>
                        <div class="form-group">
                            <label for="ali-empresa2-unitario">Valor Unitário (R$)</label>
                            <input type="text" id="ali-empresa2-unitario" class="valor-monetario" placeholder="0,00">
                        </div>
                        <div class="form-group">
                            <label for="ali-empresa2-total">Valor Total (R$)</label>
                            <input type="text" id="ali-empresa2-total" readonly>
                        </div>
                        <div class="form-group">
                            <label for="ali-empresa2-selecionada">Selecionar Empresa</label>
                            <input type="radio" name="ali-empresa-selecionada" id="ali-empresa2-selecionada" value="2" onchange="mostrarJustificativa('ali', 2)">
                        </div>
                    </div>
                    
                    <!-- Empresa 3 -->
                    <div class="empresa">
                        <h4>Empresa 3</h4>
                        <div class="form-group">
                            <label for="ali-empresa3-nome">Nome</label>
                            <input type="text" id="ali-empresa3-nome" placeholder="Nome da empresa">
                        </div>
                        <div class="form-group">
                            <label for="ali-empresa3-cnpj">CNPJ</label>
                            <input type="text" id="ali-empresa3-cnpj" placeholder="XX.XXX.XXX/XXXX-XX">
                        </div>
                        <div class="form-group">
                            <label for="ali-empresa3-link">Link (obrigatório)</label>
                            <input type="url" id="ali-empresa3-link" placeholder="https://..." required>
                        </div>
                        <div class="form-group">
                            <label for="ali-empresa3-unitario">Valor Unitário (R$)</label>
                            <input type="text" id="ali-empresa3-unitario" class="valor-monetario" placeholder="0,00">
                        </div>
                        <div class="form-group">
                            <label for="ali-empresa3-total">Valor Total (R$)</label>
                            <input type="text" id="ali-empresa3-total" readonly>
                        </div>
                        <div class="form-group">
                            <label for="ali-empresa3-selecionada">Selecionar Empresa</label>
                            <input type="radio" name="ali-empresa-selecionada" id="ali-empresa3-selecionada" value="3" onchange="mostrarJustificativa('ali', 3)">
                        </div>
                    </div>
                </div>
                
                <div class="form-group" style="margin-top: 20px;">
                    <label for="ali-menor-valor">Menor Valor Cotado (R$)</label>
                    <input type="text" id="ali-menor-valor" readonly>
                </div>
                
                <div class="form-group" id="ali-justificativa-container" style="display: none;">
                    <label for="ali-justificativa">Justificativa</label>
                    <textarea id="ali-justificativa" placeholder="Justifique a escolha de uma empresa com valor superior ao menor cotado"></textarea>
                </div>
                
                <button class="btn btn-success" id="ali-adicionar-carrinho">Adicionar ao Carrinho</button>
            </div>
        </div>

        <!-- Carrinho de Compras -->
        <div class="carrinho">
            <h3>Carrinho de Compras</h3>
            <div id="lista-carrinho" class="carrinho-vazio">
                Nenhum item adicionado ao carrinho
            </div>
            <div id="total-carrinho" class="total-carrinho">
                Total no Carrinho: R$ 0,00
            </div>
            <div class="acoes-carrinho">
                <button class="btn" id="btn-exportar-excel">Gerar Excel</button>
                <button class="btn btn-success" id="btn-finalizar">Finalizar Precificação</button>
            </div>
        </div>
    </div>

    <footer class="footer">
        © 2025 Ministério do Esporte - Todos os direitos reservados
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar se a biblioteca SheetJS está carregada
            if (typeof XLSX === 'undefined') {
                alert('Erro: A biblioteca SheetJS não foi carregada. Verifique sua conexão com a internet ou tente novamente.');
                return;
            }

            // Recupera valores da sessionStorage
            let numeroProposta = sessionStorage.getItem('numeroProposta') || 'sem-numero';
            numeroProposta = numeroProposta.replace(/[^a-zA-Z0-9_-]/g, '_');
            const valorEmenda = parseFloat(sessionStorage.getItem('valorEmenda')) || 0;
            document.getElementById('valor-total').textContent = formatarMoeda(valorEmenda);
            document.getElementById('valor-restante').textContent = formatarMoeda(valorEmenda);
            
            // Variáveis do carrinho
            let carrinho = [];
            let valorGasto = 0;

            // Controle do checkbox de declaração
            const declaracaoCheckbox = document.getElementById('declaracao-checkbox');
            const btnExportarExcel = document.getElementById('btn-exportar-excel');
            
            declaracaoCheckbox.addEventListener('change', function() {
                btnExportarExcel.disabled = !this.checked;
            });
            
            // Sistema de abas
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    tabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    const tabId = this.getAttribute('data-tab');
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(tabId).classList.add('active');
                });
            });

            // Função para alternar o campo "Outros"
            window.toggleOutrosField = function(prefixo) {
                const cargoSelect = document.getElementById(`${prefixo}-cargo`);
                const outrosContainer = document.getElementById(`${prefixo}-outros-container`);
                if (cargoSelect.value === "Outros") {
                    outrosContainer.style.display = 'block';
                } else {
                    outrosContainer.style.display = 'none';
                }
            }

            // Função para alternar campos de locação/aquisição
            window.toggleLocacaoFields = function() {
                const tipo = document.getElementById('me-tipo').value;
                const periodoContainer = document.getElementById('me-periodo-container');
                const periodoValorContainer = document.getElementById('me-periodo-valor-container');
                if (tipo === 'aquisicao') {
                    periodoContainer.style.display = 'none';
                    periodoValorContainer.style.display = 'none';
                    document.getElementById('me-periodo').value = 'diarias';
                    document.getElementById('me-periodo-valor').value = '1';
                } else {
                    periodoContainer.style.display = 'block';
                    periodoValorContainer.style.display = 'block';
                }
                calcularTotal('me');
            }

            // Função para mostrar campo de justificativa
            window.mostrarJustificativa = function(prefixo, empresaIndex) {
                const menorValor = parseFloat(document.getElementById(`${prefixo}-menor-valor`).value.replace('R$ ', '').replace('.', '').replace(',', '.')) || 0;
                const valorSelecionado = parseFloat(document.getElementById(`${prefixo}-empresa${empresaIndex}-total`).value.replace('R$ ', '').replace('.', '').replace(',', '.')) || 0;
                const justificativaContainer = document.getElementById(`${prefixo}-justificativa-container`);
                
                if (valorSelecionado > menorValor) {
                    justificativaContainer.style.display = 'block';
                } else {
                    justificativaContainer.style.display = 'none';
                }
            }

            // Cálculos para cada aba
            const prefixes = ['rh', 'me', 'uni'];
            prefixes.forEach(prefixo => {
                const quantidadeInput = document.getElementById(`${prefixo}-quantidade`);
                const periodoValorInput = document.getElementById(`${prefixo}-periodo-valor`);
                const totalInput = document.getElementById(`${prefixo}-total`);

                function calcularTotal() {
                    const quantidade = parseInt(quantidadeInput.value) || 0;
                    let total = quantidade;
                    if (prefixo === 'me' && document.getElementById('me-tipo').value === 'locacao') {
                        const periodoValor = parseInt(periodoValorInput.value) || 0;
                        total = quantidade * periodoValor;
                    } else if (prefixo !== 'me') {
                        const periodoValor = parseInt(periodoValorInput.value) || 0;
                        total = quantidade * periodoValor;
                    }
                    totalInput.value = total;
                    calcularTotaisEmpresas(prefixo);
                    return total;
                }

                quantidadeInput.addEventListener('change', () => calcularTotal());
                if (periodoValorInput) {
                    periodoValorInput.addEventListener('change', () => calcularTotal());
                }
                if (prefixo === 'me') {
                    document.getElementById('me-tipo').addEventListener('change', () => calcularTotal());
                }
            });

            // Função para calcular totais das empresas
            function calcularTotaisEmpresas(prefixo) {
                const total = parseInt(document.getElementById(`${prefixo}-total`).value) || 0;
                let menorValor = Infinity;
                
                for (let i = 1; i <= 3; i++) {
                    const unitarioInput = document.getElementById(`${prefixo}-empresa${i}-unitario`);
                    if (!unitarioInput) {
                        console.warn(`Input ${prefixo}-empresa${i}-unitario não encontrado`);
                        continue;
                    }
                    const unitario = parseFloat(
                        unitarioInput.value.replace('.', '').replace(',', '.') || '0'
                    ) || 0;
                    
                    const valorTotal = unitario * total;
                    const valorTotalFormatado = formatarMoeda(valorTotal);
                    
                    const totalInput = document.getElementById(`${prefixo}-empresa${i}-total`);
                    if (totalInput) {
                        totalInput.value = valorTotalFormatado;
                    } else {
                        console.warn(`Input ${prefixo}-empresa${i}-total não encontrado`);
                    }
                    
                    if (valorTotal < menorValor && valorTotal > 0) {
                        menorValor = valorTotal;
                    }
                }
                
                const menorValorInput = document.getElementById(`${prefixo}-menor-valor`);
                if (menorValorInput) {
                    menorValorInput.value = menorValor !== Infinity ? formatarMoeda(menorValor) : 'R$ 0,00';
                }
                
                return menorValor !== Infinity ? menorValor : 0;
            }
            
            // Configurar máscara monetária
            document.querySelectorAll('.valor-monetario').forEach(input => {
                input.addEventListener('input', function(e) {
                    try {
                        let value = e.target.value.replace(/\D/g, '');
                        value = (value / 100).toLocaleString('pt-BR', {
                            minimumFractionDigits: 2,
                            maximumFractionDigits: 2
                        });
                        e.target.value = value;
                        
                        const id = e.target.id;
                        if (id && id.includes('unitario')) {
                            const prefixo = id.split('-')[0];
                            if (prefixo) {
                                calcularTotaisEmpresas(prefixo);
                            }
                        }
                    } catch (error) {
                        console.error('Erro ao formatar valor monetário:', error);
                    }
                });
            });

            // Adicionar item ao carrinho
            prefixes.forEach(prefixo => {
                const btnAdicionar = document.getElementById(`${prefixo}-adicionar-carrinho`);
                if (!btnAdicionar) {
                    console.warn(`Botão ${prefixo}-adicionar-carrinho não encontrado`);
                    return;
                }
                btnAdicionar.addEventListener('click', function() {
                    const cargoOuItem = prefixo === 'rh' 
                        ? (document.getElementById(`${prefixo}-cargo`).value === "Outros" 
                            ? document.getElementById(`${prefixo}-outros`).value 
                            : document.getElementById(`${prefixo}-cargo`).value)
                        : document.getElementById(`${prefixo}-item`).value;
                    const descricao = document.getElementById(`${prefixo}-descricao`).value;
                    const quantidade = parseInt(document.getElementById(`${prefixo}-quantidade`).value) || 0;
                    const periodo = prefixo === 'me' && document.getElementById('me-tipo').value === 'aquisicao' 
                        ? 'aquisicao' 
                        : document.getElementById(`${prefixo}-periodo`).value;
                    const periodoValor = prefixo === 'me' && document.getElementById('me-tipo').value === 'aquisicao' 
                        ? 1 
                        : parseInt(document.getElementById(`${prefixo}-periodo-valor`).value) || 0;
                    const tipo = prefixo === 'me' ? document.getElementById('me-tipo').value : null;
                    const total = tipo === 'aquisicao' ? quantidade : quantidade * periodoValor;

                    if (!cargoOuItem || !descricao || quantidade <= 0 || (tipo !== 'aquisicao' && periodoValor <= 0)) {
                        alert('Preencha todos os campos obrigatórios!');
                        return;
                    }

                    const empresas = [];
                    let menorValor = Infinity;
                    let empresaSelecionada = null;
                    const selecionada = document.querySelector(`input[name="${prefixo}-empresa-selecionada"]:checked`);

                    for (let i = 1; i <= 3; i++) {
                        const nome = document.getElementById(`${prefixo}-empresa${i}-nome`).value;
                        const cnpj = document.getElementById(`${prefixo}-empresa${i}-cnpj`).value;
                        const link = document.getElementById(`${prefixo}-empresa${i}-link`).value;
                        const unitario = parseFloat(
                            document.getElementById(`${prefixo}-empresa${i}-unitario`).value.replace('.', '').replace(',', '.') || '0'
                        ) || 0;
                        const valorTotal = unitario * total;

                        if (nome && link && valorTotal > 0) {
                            empresas.push({
                                nome,
                                cnpj,
                                link,
                                unitario,
                                total: valorTotal
                            });

                            if (valorTotal < menorValor) {
                                menorValor = valorTotal;
                            }

                            if (selecionada && parseInt(selecionada.value) === i) {
                                empresaSelecionada = {
                                    nome,
                                    cnpj,
                                    link,
                                    unitario,
                                    total: valorTotal
                                };
                            }
                        }
                    }

                    if (empresas.length === 0) {
                        alert('Informe pelo menos uma empresa válida com link!');
                        return;
                    }

                    if (!empresaSelecionada) {
                        alert('Selecione uma empresa!');
                        return;
                    }

                    const valorSelecionado = empresaSelecionada.total;
                    let justificativa = '';
                    if (valorSelecionado > menorValor) {
                        justificativa = document.getElementById(`${prefixo}-justificativa`).value;
                        if (!justificativa) {
                            alert('Justificativa é obrigatória quando o valor selecionado é maior que o menor valor cotado!');
                            return;
                        }
                    }

                    if (valorGasto + valorSelecionado > valorEmenda) {
                        alert('Valor excede o saldo disponível na emenda!');
                        return;
                    }

                    const novoItem = {
                        id: Date.now(),
                        tipo: prefixo === 'rh' ? 'recursos-humanos' : prefixo === 'me' ? 'material-esportivo' : 'uniformes',
                        cargoOuItem,
                        descricao,
                        quantidade,
                        periodo,
                        periodoValor,
                        total,
                        empresas,
                        empresaSelecionada,
                        valor: valorSelecionado,
                        justificativa,
                        data: new Date(),
                        materialTipo: prefixo === 'me' ? tipo : null
                    };

                    carrinho.push(novoItem);
                    valorGasto += valorSelecionado;

                    atualizarCarrinho();
                    atualizarResumoValores();

                    // Limpa o formulário
                    if (prefixo === 'rh') {
                        document.getElementById(`${prefixo}-cargo`).value = 'Coordenador de eventos';
                        toggleOutrosField(prefixo);
                    } else {
                        document.getElementById(`${prefixo}-item`).value = '';
                    }
                    document.getElementById(`${prefixo}-descricao`).value = '';
                    document.getElementById(`${prefixo}-quantidade`).value = '1';
                    document.getElementById(`${prefixo}-periodo`).value = 'diarias';
                    if (prefixo === 'me') {
                        document.getElementById('me-tipo').value = 'aquisicao';
                        toggleLocacaoFields();
                    }
                    document.getElementById(`${prefixo}-periodo-valor`).value = '1';
                    document.getElementById(`${prefixo}-total`).value = '';

                    for (let i = 1; i <= 3; i++) {
                        document.getElementById(`${prefixo}-empresa${i}-nome`).value = '';
                        document.getElementById(`${prefixo}-empresa${i}-cnpj`).value = '';
                        document.getElementById(`${prefixo}-empresa${i}-link`).value = '';
                        document.getElementById(`${prefixo}-empresa${i}-unitario`).value = '';
                        document.getElementById(`${prefixo}-empresa${i}-total`).value = '';
                        document.getElementById(`${prefixo}-empresa${i}-selecionada`).checked = false;
                    }

                    document.getElementById(`${prefixo}-menor-valor`).value = '';
                    document.getElementById(`${prefixo}-justificativa-container`).style.display = 'none';
                    document.getElementById(`${prefixo}-justificativa`).value = '';
                });
            });

            // Função para atualizar o carrinho
            function atualizarCarrinho() {
                const listaCarrinho = document.getElementById('lista-carrinho');
                
                if (carrinho.length === 0) {
                    listaCarrinho.innerHTML = 'Nenhum item adicionado ao carrinho';
                    listaCarrinho.className = 'carrinho-vazio';
                    declaracaoCheckbox.disabled = true;
                    declaracaoCheckbox.checked = false;
                    btnExportarExcel.disabled = true;
                } else {
                    listaCarrinho.className = '';
                    declaracaoCheckbox.disabled = false;
                    listaCarrinho.innerHTML = carrinho.map(item => `
                        <div class="item-carrinho" data-id="${item.id}">
                            <div class="item-carrinho-info">
                                <strong>${item.cargoOuItem} - ${item.descricao}</strong><br>
                                <small>${item.quantidade} x ${item.periodo} (${item.periodoValor}) = ${item.total} | Valor selecionado: ${formatarMoeda(item.valor)}</small>
                                <br><small>Empresa: ${item.empresaSelecionada.nome}</small>
                                ${item.materialTipo ? `<br><small>Tipo: ${item.materialTipo === 'aquisicao' ? 'Aquisição' : 'Locação'}</small>` : ''}
                                ${item.justificativa ? `<br><small>Justificativa: ${item.justificativa}</small>` : ''}
                            </div>
                            <div class="item-carrinho-acoes">
                                <button class="remover-item">Remover</button>
                            </div>
                        </div>
                    `).join('');
                    
                    // Adiciona eventos aos botões de remover
                    document.querySelectorAll('.remover-item').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const itemId = parseInt(this.closest('.item-carrinho').getAttribute('data-id'));
                            removerItemCarrinho(itemId);
                        });
                    });
                }
                
                document.getElementById('total-carrinho').textContent = `Total no Carrinho: ${formatarMoeda(valorGasto)}`;
            }
            
            // Função para remover item do carrinho
            function removerItemCarrinho(itemId) {
                const itemIndex = carrinho.findIndex(item => item.id === itemId);
                if (itemIndex !== -1) {
                    const itemRemovido = carrinho[itemIndex];
                    valorGasto -= itemRemovido.valor;
                    carrinho.splice(itemIndex, 1);
                    
                    atualizarCarrinho();
                    atualizarResumoValores();
                }
            }
            
            // Função para atualizar os valores resumidos
            function atualizarResumoValores() {
                document.getElementById('valor-gasto').textContent = formatarMoeda(valorGasto);
                document.getElementById('valor-restante').textContent = formatarMoeda(valorEmenda - valorGasto);
            }
            
            // Função para formatar valores monetários
            function formatarMoeda(valor) {
                return 'R$ ' + (typeof valor === 'number' ? valor : 0).toLocaleString('pt-BR', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                });
            }

            // Exportar para Excel
            document.getElementById('btn-exportar-excel').addEventListener('click', function() {
                if (carrinho.length === 0) {
                    alert('O carrinho está vazio!');
                    return;
                }

                if (!declaracaoCheckbox.checked) {
                    alert('Você deve marcar a declaração antes de gerar o Excel!');
                    return;
                }

                try {
                    // Validar dados do carrinho
                    console.log('Carrinho:', JSON.stringify(carrinho, null, 2));
                    for (const item of carrinho) {
                        if (!item || !item.empresas || !Array.isArray(item.empresas)) {
                            throw new Error(`Item ${item.cargoOuItem || 'desconhecido'} não possui array de empresas válido`);
                        }
                        if (!item.empresaSelecionada) {
                            throw new Error(`Item ${item.cargoOuItem || 'desconhecido'} não possui empresa selecionada`);
                        }
                    }

                    const wb = XLSX.utils.book_new();
                    const identificador = `precificacao_emenda_${numeroProposta}`;

                    // Aba Cotações
                    const dadosCotações = [
                        ['Declaro que os custos aqui registrados estão em estrita conformidade aos orçamentos apresentados para fins de comprovação dos valores estimados de cada item.'],
                        [''],
                        [
                            'Identificador',
                            'Tipo',
                            'Cargo/Item',
                            'Descrição',
                            'Quantidade',
                            'Período',
                            'Valor do Período',
                            'Total',
                            'Empresa',
                            'CNPJ',
                            'Valor Unitário',
                            'Valor Total',
                            'Link da Cotação',
                            'Selecionada',
                            'Justificativa'
                        ]
                    ];

                    carrinho.forEach(item => {
                        if (!item || !item.empresas || !Array.isArray(item.empresas)) {
                            console.warn('Ignorando item inválido:', item);
                            return;
                        }

                        item.empresas.forEach(empresa => {
                            const selecionada = item.empresaSelecionada && item.empresaSelecionada.nome === empresa.nome ? 'Sim' : 'Não';
                            dadosCotações.push([
                                identificador,
                                formatarTipo(item.tipo),
                                item.cargoOuItem || '-',
                                item.descricao || '-',
                                item.quantidade || 0,
                                item.materialTipo === 'aquisicao' ? 'Aquisição' : item.periodo || '-',
                                item.materialTipo === 'aquisicao' ? '-' : (item.periodoValor || '-'),
                                item.total || 0,
                                empresa.nome || '-',
                                empresa.cnpj || '-',
                                formatarMoeda(empresa.unitario),
                                formatarMoeda(empresa.total),
                                empresa.link || '-',
                                selecionada,
                                selecionada === 'Sim' ? (item.justificativa || '-') : '-'
                            ]);
                        });
                    });

                    if (dadosCotações.length <= 3) {
                        throw new Error('Nenhuma cotação válida encontrada para exportação');
                    }

                    const wsCotações = XLSX.utils.aoa_to_sheet(dadosCotações);
                    XLSX.utils.book_append_sheet(wb, wsCotações, 'Cotações');

                    // Aba PAD (somente Material Esportivo)
                    const dadosPAD = [
                        [
                            'Identificador',
                            'Item',
                            'Descrição',
                            'Quantidade',
                            'Tipo',
                            'Período',
                            'Valor do Período',
                            'Empresa Selecionada',
                            'CNPJ',
                            'Valor Unitário',
                            'Valor Total',
                            'Link da Cotação',
                            'Justificativa'
                        ]
                    ];

                    carrinho.filter(item => item.tipo === 'material-esportivo').forEach(item => {
                        if (!item.empresaSelecionada) {
                            console.warn(`Item ${item.cargoOuItem || 'desconhecido'} sem empresa selecionada para PAD`);
                            return;
                        }
                        dadosPAD.push([
                            identificador,
                            item.cargoOuItem || '-',
                            item.descricao || '-',
                            item.quantidade || 0,
                            item.materialTipo === 'aquisicao' ? 'Aquisição' : 'Locação',
                            item.materialTipo === 'aquisicao' ? '-' : (item.periodo || '-'),
                            item.materialTipo === 'aquisicao' ? '-' : (item.periodoValor || '-'),
                            item.empresaSelecionada.nome || '-',
                            item.empresaSelecionada.cnpj || '-',
                            formatarMoeda(item.empresaSelecionada.unitario),
                            formatarMoeda(item.empresaSelecionada.total),
                            item.empresaSelecionada.link || '-',
                            item.justificativa || '-'
                        ]);
                    });

                    const wsPAD = XLSX.utils.aoa_to_sheet(dadosPAD);
                    XLSX.utils.book_append_sheet(wb, wsPAD, 'PAD');

                    // Adicionar totais no final da aba Cotações
                    const totais = [
                        ['', '', '', '', '', '', '', '', '', '', '', '', '', '', ''],
                        ['Data:', new Date().toISOString().split('T')[0], '', '', '', '', '', '', '', '', '', '', '', '', ''],
                        ['Valor Total da Emenda:', formatarMoeda(valorEmenda), '', '', '', '', '', '', '', '', '', '', '', '', ''],
                        ['Valor Gasto:', formatarMoeda(valorGasto), '', '', '', '', '', '', '', '', '', '', '', '', ''],
                        ['Valor Restante:', formatarMoeda(valorEmenda - valorGasto), '', '', '', '', '', '', '', '', '', '', '', '', '']
                    ];
                    XLSX.utils.sheet_add_aoa(wsCotações, totais, { origin: -1 });

                    // Função auxiliar para formatar o tipo
                    function formatarTipo(tipo) {
                        const tipos = {
                            'recursos-humanos': 'Recursos Humanos',
                            'material-esportivo': 'Material Esportivo',
                            'uniformes': 'Uniformes'
                        };
                        return tipos[tipo] || tipo;
                    }

                    // Salvar o arquivo Excel
                    XLSX.writeFile(wb, `precificacao_emenda_${numeroProposta}.xlsx`);
                    alert('Arquivo Excel gerado com sucesso!');
                } catch (error) {
                    console.error('Erro ao gerar Excel:', error.message, error.stack);
                    alert(`Erro ao gerar o arquivo Excel: ${error.message}. Verifique o console para mais detalhes.`);
                }
            });

            // Finalizar precificação
            document.getElementById('btn-finalizar').addEventListener('click', function() {
                if (carrinho.length === 0) {
                    alert('Adicione itens ao carrinho antes de finalizar!');
                    return;
                }
                
                if (confirm('Deseja finalizar a precificação? Após confirmar, não será possível alterar os itens.')) {
                    // Bloquear edição
                    document.querySelectorAll('input, textarea, button').forEach(element => {
                        if (element.id !== 'btn-exportar-excel') {
                            element.disabled = true;
                        }
                    });
                    
                    // Mostrar mensagem de sucesso
                    alert('Precificação finalizada com sucesso!');
                    
                    // Desabilitar botão de finalizar
                    this.disabled = true;
                }
            });
        });
    </script>
</body>
</html>